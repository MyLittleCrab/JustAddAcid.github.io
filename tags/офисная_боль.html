<!DOCTYPE html><html lang="ru"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="Nosoff.info — personal blog"/><title>Nosoff.info #офисная_боль</title><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/ac13a076880d654a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ac13a076880d654a.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-9b312e20a4e32339.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-f65e66e62fc5ca80.js" defer=""></script><script src="/_next/static/chunks/pages/_app-56332fb66f8b377f.js" defer=""></script><script src="/_next/static/chunks/782-caa534ae626186f6.js" defer=""></script><script src="/_next/static/chunks/pages/tags/%5Btag%5D-1db20fdeb9a8e960.js" defer=""></script><script src="/_next/static/aokFtgUfRNfaaZvZKf0qy/_buildManifest.js" defer=""></script><script src="/_next/static/aokFtgUfRNfaaZvZKf0qy/_ssgManifest.js" defer=""></script><script src="/_next/static/aokFtgUfRNfaaZvZKf0qy/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="min-h-screen"><main><div class="container mx-auto px-5"><section class="flex-col md:flex-row flex items-center md:justify-between mt-16 mb-16 md:mb-12"><a href="/"><h1 class="text-6xl md:text-8xl font-bold tracking-tighter leading-tight md:pr-8">Nosoff.info <!-- -->#офисная_боль</h1></a></section><section><div class="mb-8 md:mb-16"><div class="-mx-5 sm:mx-0"><a aria-label="Авторесайз объединенных ячеек в EXCEL" href="/posts/autoresize-excel-tables"><img src="/assets/blog/autoresize-excel-tables/background.jpg" alt="Cover Image for Авторесайз объединенных ячеек в EXCEL" class="shadow-small hover:shadow-medium transition-shadow duration-200"/></a></div></div><div class="md:col-gap-16 lg:col-gap-8 mb-20 md:mb-28"><div><h3 class="screenreader"><a class="hover:underline" href="/posts/autoresize-excel-tables">Авторесайз объединенных ячеек в EXCEL</a></h3><div class="mb-4 md:mb-0 text-lg"><time dateTime="2020-09-25T18:08:48.775Z">September	25, 2020</time></div></div><div><p class="text-lg leading-relaxed mb-4">Так уж исторически сложилось, что часто по работе люди встречаются со &quot;стандартными&quot; формами в EXCEL, которые нужно автоматически масштабировать в зависимости от контента в ячейках</p><a class="flex items-center" href="https://github.com/JustAddAcid"><img src="https://avatars3.githubusercontent.com/u/21103635?s=120&amp;v=4" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></a></div></div></section><section><h2 class="mb-8 text-6xl md:text-7xl font-bold tracking-tighter leading-tight">More Stories</h2><div class="grid grid-cols-1 md:grid-cols-2 md:col-gap-16 lg:col-gap-32 row-gap-20 md:row-gap-32 mb-32"><div><div class="mb-5"><div class="-mx-5 sm:mx-0"><a aria-label="Организуем удалённое рабочее место на машине с linux" href="/posts/remote-workplace-linux"><img src="/assets/blog/remote-workplace-linux/logo.jpg" alt="Cover Image for Организуем удалённое рабочее место на машине с linux" class="shadow-small hover:shadow-medium transition-shadow duration-200"/></a></div></div><h3 class="screenreader"><a class="hover:underline" href="/posts/remote-workplace-linux">Организуем удалённое рабочее место на машине с linux</a></h3><div class="text-lg mb-4"><time dateTime="2020-06-07T14:15:07.322Z">June	7, 2020</time></div><p class="text-lg leading-relaxed mb-4">На фоне эпидемии появилась необходимость в организации удобной удалённой работы на домашнем компьютере с ос linux на борту: настроить нормальный rdp клиент + skype for business (lync)</p><a class="flex items-center" href="https://github.com/JustAddAcid"><img src="https://avatars3.githubusercontent.com/u/21103635?s=120&amp;v=4" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></a></div></div></section></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5"></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"allPosts":[{"title":"Авторесайз объединенных ячеек в EXCEL","date":"2020-09-25T18:08:48.775Z","slug":"autoresize-excel-tables","author":{"name":"Roman A. Nosov","picture":"https://avatars3.githubusercontent.com/u/21103635?s=120\u0026v=4","url":"https://github.com/JustAddAcid"},"content":"\nПрежде чем перейти к сути, давайте на минуточку остановимся и осознаем всю степень сюрреализма, который творится в государственном документообороте. Подумайте над тем, что если вы отправляете государству какую-то распечанную *EXCEL* табличку на бумажке(потому что именно так требует закон), то на принимающей стороне есть **ОТДЕЛЬНЫЙ, МАТЬ ЕГО, ЧЕЛОВЕК**, который руками забивает эти данные куда-то себе в базу!\n\nОсознали? Прекрасно. Продолжаем.\n\n\u003ciframe width=\"100%\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/lN-Y242GOgk\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen\u003e\u003c/iframe\u003e\n\nТак уж исторически сложилось, что часто по работе люди встречаются со \"стандартными\" формами в *EXCEL*, которые нужно автоматически растягивать в зависимости от контента в ячейках. \n\nКазалось бы, достаточно распространённая тема, по которой **уйма** информации в этих ваших интернетах. Но проводить по этому поводу ликбез мне уже приходилось несколько раз за последние пару месяцев. Так что, лучше **записать** это дерьмо, чтобы не повторять одно и то же. И потратить сэкономленное время на ~~прокрастинацию~~ более важные дела.\n\n## Формулируем задачу\n\nПредставим ситуацию, в которой есть какая-то программа, которая на основании данных в *БД* заполняет какой-то *ГОСТ*-овский *EXCEL*-темплейт данными, который в будущем кому-то отправляется и/или распечатывается. И в этой (уже абсурдной) ситуации совершенно никому не хочется тратить собственное время на растягивание ячеек вручную. И очень хочется как-то этот процесс автоматизировать.\n\n## Чо делать?\n\n~~do a barrel roll~~\n\nРесайзить макросом, очевидно. Тут у нас два пути в зависимости от того, насколько над нами хотят поиздеваться окружающие:\n\n### Самый простой вариант\nЭто когда мы видим, что в документе напрочь отсутствуют объединённые ячейки, которые нужно ресайзить. А ресайзинг одиночных — *EXCEL* поддерживает нативно. Достаточно ругнуться на него вот такой командой:\n\n```vb\nCells.EntireRow.AutoFit ' Растянуть ячейки в высоту по контенту\n' Или\nCells.EntireColumn.AutoFit ' Растянуть ячейки в ширину по контенту\n\n' Или, на конкретную ячейку \nОбъектЯчейки.EntireColumn/EntireRow.AutoFit \n```\n\n### Вариант \"как всегда\"\nНо если вы читаете это, то скорее всего, у вас возникли сложности посерьёзнее. Вероятно, у вас самый обычный документ, в котором огромное количество связанных ячеек.\n\n*Що робити в цій ситуації?*\n\nМожно, конечно, попробовать изобрести очередной велосипед. А можно воспользоваться готовым кодом, который честно ~~спиз~~ сохранил из интернетов ваш покорный слуга.\n\nАвтором кода числится некий **The_Prist (Щербаков Дмитрий)** с сайта [excel-vba.ru](https://www.excel-vba.ru). Идея кода в том, что скрипт сначала временно отключает объединение ячеек, ресайзит первую ячейку с текстом нативными методами экселя, а затем объединяет ячейки обратно.\n\nПолучается достаточно просто и лаконично. Я лишь от себя добавил в код небольшой фикс, чтобы учитывались паддинги и масштабирование не \"съезжало\" при большом количестве ячеек.\n\n[Репозиторий с кодом можно найти здесь.](https://github.com/JustAddAcid/Excel_RowHeightForContent)\n\nКак этим пользоваться:\n\n1. Проверить, что у вас тип файла с поддержкой макросов (с \"m\" на конце)\n2. Залезть в *Вид* -\u003e *Макросы* -\u003e *Ввести %randomName%* -\u003e **Создать**\n3. ПКМ по *Modules* -\u003e *Insert* -\u003e **Module**\n4. Скопировать содержимое файла **RowHeightForContent.vb** из [репозитория](https://github.com/JustAddAcid/Excel_RowHeightForContent) в новый созданный модуль\n5. Вызвать **RowColHeightForContent** с нужными ячейками. \n\nНо! Один вызов функции принимает в аргументы рейндж **из одной** связанной ячейки. Нельзя сразу выделить всю страницу и попытаться её отмасштабировать.  \n\nИтоговый код вызова будет примерно вот таким\n\n```vb\n' Две статичные ячейки\nRowColHeightForContent ActiveWorkbook.Sheets(1).Range(\"S32\")\nRowColHeightForContent ActiveWorkbook.Sheets(1).Range(\"AV30\")\n\nDim i As Integer\n\n' Масштабирование строк в таблицах циклом\n' На втором листе\ni = 8\nDo While Len(ActiveWorkbook.Sheets(2).Cells(i, 7).Value) \u003e 0\n    RowColHeightForContent ActiveWorkbook.Sheets(2).Cells(i, 7) ' Седьмой столбец\n    RowColHeightForContent ActiveWorkbook.Sheets(2).Cells(i, 228) ' 228 столбец\n\n    '(или вложенным циклом от N до M столбца)\n    \n    i = i + 1\nLoop\n\n' На третьем листе\ni = 5\nDo While Len(ActiveWorkbook.Sheets(3).Cells(i, 7).Value) \u003e 0\n    RowColHeightForContent ActiveWorkbook.Sheets(3).Cells(i, 7)\n    i = i + 1\nLoop\n```\n\n## Когда делать?\n\nПо какому событию вызывать этот код? У нас не много вариантов: \n\n1. Если происходит заполнение темплейта через EXCEL-OLE API, то можно попробовать подвязаться на событие завершения сборки файла. (Тут нужно смотреть документацию вашего инструмента, который выгружает)\n2. Во всех остальных случаях — можно выполнять код по событию **\"Открытие файла\"** (*Workbook_Open*).\n   1. Для этого, нужно открыть модуль \"Эта книга\": ![Эта книга](../public/assets/blog/autoresize-excel-tables/this_book.png)\n   2. Затем создать функцию **Workbook_Open** примерно вот так:\n\n```vb\nPrivate Sub Workbook_Open()\n\n' Здесь код ресайза\n\nEnd Sub\n```\n\nВ которую положить ~~болт~~ код ресайза нужных вам ячеек в документе. При открытии файла у пользователя будет всплывать запрос на разрешение выполнения макроса. И если он согласится — выбранные программистом ячейки будут растянуты по размеру содержимого. Собсна, всё.\n\n## Послание читателю\n\nВозможно, я недостаточно раскрыл тему. Так что, если у вас остались вопросы — ~~гугл вам в помощь~~ прошу нафлудить в комментариях.\n\nВсех благ\n\n#excel #офисная_боль","ogImage":{"url":"/assets/blog/autoresize-excel-tables/background.jpg"},"coverImage":"/assets/blog/autoresize-excel-tables/background.jpg","issueId":"16","excerpt":"Так уж исторически сложилось, что часто по работе люди встречаются со \"стандартными\" формами в EXCEL, которые нужно автоматически масштабировать в зависимости от контента в ячейках"},{"title":"Организуем удалённое рабочее место на машине с linux","date":"2020-06-07T14:15:07.322Z","slug":"remote-workplace-linux","author":{"name":"Roman A. Nosov","picture":"https://avatars3.githubusercontent.com/u/21103635?s=120\u0026v=4","url":"https://github.com/JustAddAcid"},"content":"\nНа фоне эпидемии появилась необходимость в организации удобной удалённой работы на домашнем компьютере с ос *linux* на борту: настроить *rdp* клиент + *skype for business* (*lync*).\n\n### Зачем?\n\nНе все работодатели готовы предоставлять работникам именно *VPN* для доступа к корпоративным сервисам. Лишь открывают RDP-терминал. Видимо, так им кажется безопаснее ¯\\\\_(ツ)_/¯. А также, некоторые вещи физически невозможно развернуть на локальных машинах, так что в некоторых ситуациях протокол удалённых рабочих столов просто необходим.\n\n### Как должно работать в идеале:\n\n1. Нужен настроенный *RDP* клиент с поддержкой *gateways* на linux, который по одному клику открывает рабочий стол удалённой машины.\n2. Нужна возможность созваниваться по skype for business с коллегами без огромных задержек от RDP. В идеале — запуск клиента на локальной машине.\n\n## Добываем себе возможность работать в трусах\n![Удалёнка](../public/assets/blog/remote-workplace-linux/meme.jpg)\n\n\n### RDP\nВ качестве rdp клиента будем использовать *freerdp* — это один из немногих linux rdp клиентов, который поддерживает шлюзы (gateways). Устанавливаем:\n\n```bash\nsudo apt instal freerdp\n``` \nТеперь запускать удалённые rdp-сеансы мы можем с помощью консольной команды **xfreerdp**. С определенными параметрами:\n\nСо всеми доступными параметрами можно [познакомиться (здесь)](https://github.com/FreeRDP/FreeRDP/wiki/CommandLineInterface \"CommandLineInterface\"). Но нас интересуют вполне конкретные:\n\n1. **/f** — fullscreen mode\n2. **/multimon** — поддержка нескольких мониторов\n3. **/rfx** — \"расширенный\" протокол поверх RDP. \n4. (опционально) **/sound:sys:alsa** — включение стриминга звука на локальную машину\n5. **+clipboard** — расшаривание буфера обмена между удалённым рабочим столом и клиентской машиной\n6. **+fonts** — включить сглаживание шрифтов. \n7. **/v** — хост url\n8. **/d** — домен пользователя,\n9. **/u** — пользователь\n10. **/p** — пароль пользователя\n11. **/g** — шлюз url\n12. **/gd** — домен для авторизации на шлюзе\n13. **/gu** — пользователь для авторизации на шлюзе\n14. **/gp** — пароль для авторизации на шлюзе\n\nИтоговый скрипт запуска у нас будет следующим:\n\n```bash\n#! /bin/bash\n\nxfreerdp /v:targetUrl /d:domain /u:username /p:password /g:gateway /gd:domain /gu:username /gp:password /f /multimon /rfx /sound:sys:alsa +clipboard +fonts\n```\nВсё это можно сохранить в текстовом файле, сделать его исполняемым и положить для удобства на рабочий стол.\n\n```bash\nsudo chmod +x filename # Сделать исполняемым\n```\n\n### Skype for business (lync)\n\nНесмотря на то, что порт обычной (не бизнесовой) версии скайпа  на линукс официально поставляется разработчиками — бизнесовой версии под linux **нет**. Браузерная версия Skype (*Skype web app*) тоже не заведется, т.к. для его функционирования нужно нативное windows-расширение для браузера. Как быть?\n\nВ этом нам поможет прекрасный плагин для мессенджеров — [SIPE](https://sipe.sourceforge.io/ \"A third-party Pidgin plugin for Microsoft LCS/OCS\"). Он позиционирует себя как open-source имплементация протокола OCS, по которому общаются клиенты *Skype for business*.\n\nУстановим pidgin + sipe\n\n```bash\nsudo apt install pidgin pidgin-sipe\n```\n\nПри создании учетных записей выбираем протокол \"Office Communicator\"\n![Pidgin protocols list](../public/assets/blog/remote-workplace-linux/pidgin-protocols.png)\n\nВводим active directory login/e-mail/пароль. И вуаля! Подключается и работает.\n\nПоскольку, это не официальный клиент, многие (не основные) функции могут отсутствовать. Но базовых более чем хватает:\n\n1. Чат\n2. Звонки, как приватные, так и конференции. \n3. Демонстрация рабочего стола\n4. Совместное использование рабочего стола\n\n#linux #танцы_с_бубном #офисная_боль ","ogImage":{"url":"/assets/blog/remote-workplace-linux/logo.jpg"},"coverImage":"/assets/blog/remote-workplace-linux/logo.jpg","issueId":"9","excerpt":"На фоне эпидемии появилась необходимость в организации удобной удалённой работы на домашнем компьютере с ос linux на борту: настроить нормальный rdp клиент + skype for business (lync)"}],"tag":"офисная_боль"},"__N_SSG":true},"page":"/tags/[tag]","query":{"tag":"офисная_боль"},"buildId":"aokFtgUfRNfaaZvZKf0qy","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>