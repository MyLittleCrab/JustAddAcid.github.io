<!DOCTYPE html><html lang="ru"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="Nosoff.info — personal blog"/><title>Как запилить реактивность на SAPUI5 — часть 1</title><meta property="og:image" content="/assets/blog/sapui5-state/cover2withHeader.png"/><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/8989f9f4657d19f0fcdb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8989f9f4657d19f0fcdb.css" data-n-g=""/><link rel="preload" href="/_next/static/css/6dab348d518a0e6702e4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6dab348d518a0e6702e4.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-61095c13c5984b221292.js" defer=""></script><script src="/_next/static/chunks/framework-92300432a1172ef1338b.js" defer=""></script><script src="/_next/static/chunks/main-a3a79aff3ff232b41814.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f98b93c1570ecf70d9fa.js" defer=""></script><script src="/_next/static/chunks/853-ae4f3fbc7686be6d8798.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-27720eb20c91d7796fb9.js" defer=""></script><script src="/_next/static/WGLPwn0mPPHoFJAY34UX7/_buildManifest.js" defer=""></script><script src="/_next/static/WGLPwn0mPPHoFJAY34UX7/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen"><main><div class="container mx-auto px-5"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8"><a class="hover:underline" href="/">Nosoff.info</a></h2><article class="mb-32"><h1 class="screenreader">Как запилить реактивность на SAPUI5 — часть 1</h1><div class="hidden md:block md:mb-12"><a class="flex items-center" href="https://github.com/JustAddAcid"><img src="https://avatars3.githubusercontent.com/u/21103635?s=120&amp;v=4" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></a></div><div class="mb-8 md:mb-16 -mx-5 sm:mx-0"><div class="-mx-5 sm:mx-0"><img src="/assets/blog/sapui5-state/cover2withHeader.png" alt="Cover Image for Как запилить реактивность на SAPUI5 — часть 1" class="shadow-small"/></div></div><div class="max-w-2xl mx-auto"><div class="block md:hidden mb-6"><a class="flex items-center" href="https://github.com/JustAddAcid"><img src="https://avatars3.githubusercontent.com/u/21103635?s=120&amp;v=4" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></a></div><div class="mb-6 text-lg"><time dateTime="2020-06-15T14:15:07.322Z">June	15, 2020</time></div></div><div class="max-w-2xl mx-auto"><div class="markdown-styles_markdown__1x9gM"><p>Решил описать то, как можно удобно хранить состояния экранов (или всего приложения) внутри <em>SAPUI5</em> и делать реактивность (Почти как у больших и нормальных фреймворков).</p>
<p><strong>Для тех, кто в танке и никогда не слышал, что это такое</strong> <em>SAPUI5</em> — это фронтенд-фреймворк. Как  хипстерские <em>Vue</em> и <em>React</em>, только никому не нужен. Используется для быстрого написания фронтендов поверх выгрузки данных из SAP-ERP. </p>
<p>Внезапно, но он действительно неплохо интегрирован со всей сап-экосистемой и простенькие приложения (внутри определенных рамок) писать не сильно больно. Проблемы начинаются тогда, когда нужно сделать что-то <em>большее</em>, чем просто нарисовать табличку с двумя кнопками. И внезапно вылезают всеобщая громоздкость синтаксиса, нестабильность работы некоторых контролов и отсутствие нормального комьюнити.</p>
<p><img src="../assets/blog/sapui5-state/meme.png" alt="Learning programming sapui5"></p>
<h2>Стейты стейты стейты</h2>
<h3>Для начала немного теории</h3>
<p>Что такое реактивное программирование очень хорошо объяснено <a href="https://webdevblog.ru/ponimanie-reaktivnosti-vo-vue-js-shag-za-shagom/">здесь</a> только примеры для другого фреймворка. Но это не важно! :)</p>
<p>В основе лежит идея о том, что было бы очень неплохо, если бы контролы сами смотрели в данные и <strong>перестраивались</strong> бы автоматически, если что-нибудь в этих данных поменяется, без кучи явных хендлеров и присвоений значений в контролы по многу раз. </p>
<p>И наоборот — было бы неплохо, если бы данные <strong>перестраивались</strong> автоматически, если, например, в каком-нибудь input'e пользователь ввел другое значение.</p>
<h4>Вот такой вот интересный <strong>two-way binding</strong> ¯\<em>(ツ)</em>/¯</h4>
<p>Давайте человеческим языком — суть в том, что все данные у нас сложены в одну коробку (массив/объект) и все контролы на странице рендерятся на основе этих данных. </p>
<p>Плюсы здесь в том, что это, мать его, облегчает чтение и уменьшает размер нашего нелюбимого жабаскрипта. А чем меньше жабаскрипта — тем лучше.</p>
<p>А ещё сразу понятно, что приложение делает, если взглянуть на модель данных. А ещё это кодится быстрее за ту же зарплату. Ну вы понимаете.</p>
<h3>Разберем на практике избитый пример:</h3>
<h4>Тудушница</h4>
<p>Давайте за минуту напишем простейший toDo-лист с единым хранением состояния. </p>
<p>Для начала создаём пустое <em>SAPUI5</em> приложение с единственной view — <em>index.view.xml</em>, которая сразу при открытии будет отображаться пользователю. </p>
<p>Идем от данных! Какие данные примерно должна хранить todo-list? Наверное, массив заметок с полями: checked, text, и id. Ну и содержимое текстового поля, которое генерирует новые заметки. Получилось примерно вот так:</p>
<div class="remark-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
    input<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    todos<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// Тут будут объекты вот в таком формате:</span>
    <span class="token comment">// 	{</span>
    <span class="token comment">// 	id: "1",</span>
    <span class="token comment">// 	text: "one",</span>
    <span class="token comment">// 	checked: true</span>
    <span class="token comment">// }</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre></div>
<p>Состояние в <em>SAPUI5</em> лучше всего хранить в объекте класса sap.ui.model.json.<strong>JSONModel</strong>. Он позволяет подписываться на изменения каждого из свойства хранимого объекта, - как из XML-view в декларативном стиле, так и напрямую писать хендлеры изменений из кода. Почему класс называется именно JSONModel - для меня остаётся загадкой, т.к. де-факто он хранит обычный JavaScript объект.</p>
<p>Открываем файл <em>/controller/index.controller.js</em> и по событию инициализации создаём <em>JSON-model</em> и заполняем её данными.</p>
<div class="remark-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token function-variable function">onInit</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">viewState</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONModel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      input<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      todos<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">getView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">setModel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">viewState</span><span class="token punctuation">,</span> <span class="token string">"viewState"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div>
<p>Модель присваивается к <em>View</em> с помощью метода <em>.setModel</em>. В данном конкретном случае псевдоним модели ("<em>viewState</em>") можно было не указывать, т.к. модель всего одна и путаницы возникнуть не может. </p>
<p>Давайте попробуем представить, как бы у нас выглядел метод создания новой заметки:</p>
<div class="remark-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token function-variable function">appendTodo</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> todos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">viewState</span><span class="token punctuation">.</span><span class="token method function property-access">getProperty</span><span class="token punctuation">(</span><span class="token string">"/todos"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">viewState</span><span class="token punctuation">.</span><span class="token method function property-access">setProperty</span><span class="token punctuation">(</span><span class="token string">"/todos"</span><span class="token punctuation">,</span> todos<span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      text<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">viewState</span><span class="token punctuation">.</span><span class="token method function property-access">getProperty</span><span class="token punctuation">(</span><span class="token string">"/input"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      checked<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">viewState</span><span class="token punctuation">.</span><span class="token method function property-access">setProperty</span><span class="token punctuation">(</span><span class="token string">"/input"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div>
<p>Очень просто. Получение массива заметок, создание массива со старыми + новой заметкой и присвоение его к модели. Затем очистка поля ввода.</p>
<p>В качестве id нам пока вполне подойдет текущий таймстемп. Вместо Array.prototype.concat, если очень хочется, можно использовать ES6 spread operator:</p>
<div class="remark-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> newArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token spread operator">...</span>oldArray<span class="token punctuation">,</span> newElement<span class="token punctuation">]</span>
</code></pre></div>
<p>Но не очень нужно, т.к. у sapui5 из коробки нет никакого препроцессинга кода, а написанный энтузиастами плагин для Babel не для production-use. И используя фичи es6 мы автоматически делаем наш код неспособным запуститься на ie10-11 (а у некоторых он до сих пор — корпоративный стандарт).</p>
<p>Переходим к разметке интерфейса. Там всё просто: поле создания заметок + список.</p>
<div class="remark-highlight"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>content</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>Input</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{viewState>/input}<span class="token punctuation">"</span></span> <span class="token attr-name">submit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>appendTodo<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>List</span> <span class="token attr-name">items</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{viewState>/todos}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>items</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>CustomListItem</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>HBox</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>CheckBox</span> <span class="token attr-name">selected</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{viewState>checked}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>Input</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500px<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{viewState>text}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>Button</span> <span class="token attr-name">text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X<span class="token punctuation">"</span></span> <span class="token attr-name">press</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deleteTodo<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">data:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{viewState>id}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>HBox</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>CustomListItem</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>items</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>List</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>content</span><span class="token punctuation">></span></span>
</code></pre></div>
<p>ID заметки будем передавать в data-* атрибуте. (Чтобы неймспейс data: в разметке заработал, нужно его подключить в самом верху view)</p>
<div class="remark-highlight"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token namespace">mvc:</span>View</span> 
  <span class="token attr-name">controllerName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>todoTodo.controller.index<span class="token punctuation">"</span></span> 
  <span class="token attr-name"><span class="token namespace">xmlns:</span>html</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/1999/xhtml<span class="token punctuation">"</span></span>
  <span class="token attr-name"><span class="token namespace">xmlns:</span>mvc</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sap.ui.core.mvc<span class="token punctuation">"</span></span>
	<span class="token attr-name">displayBlock</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> 
  <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sap.m<span class="token punctuation">"</span></span> 
  <span class="token attr-name"><span class="token namespace">xmlns:</span>data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
</code></pre></div>
<p>Метод удаления заметки: Получаем id из data-* атрибута и фильтруем массив.</p>
<div class="remark-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token function-variable function">deleteTodo</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> id <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token method function property-access">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">data</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> todos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">viewState</span><span class="token punctuation">.</span><span class="token method function property-access">getProperty</span><span class="token punctuation">(</span><span class="token string">"/todos"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">viewState</span><span class="token punctuation">.</span><span class="token method function property-access">setProperty</span><span class="token punctuation">(</span><span class="token string">"/todos"</span><span class="token punctuation">,</span> todos<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">todo</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> todo<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">!==</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div>
<p>Запускаем — работает! Написано всего два простых метода. </p>
<p>Сейчас нам <strong>ничего</strong> не стоит забрать данные и записать в <em>localStorage</em> браузера, или отправить на <em>сервер</em>, или как-то обрабатывать в коде, т.к. мы всегда знаем, где находятся данные и как они организованы.</p>
<p>А теперь давайте представим, сколько бы нам потребовалось геморроя, если бы мы писали это в классическом html+js... Приходилось бы руками описывать хендлеры событий каждого контрола, а сборка данных для отправки на сервер превратилась бы в сущий ад в виде цикла по всем контролам и вытаскивания значения. Конечно, для данного примера этот аргумент звучит не слишком сурово. Но представьте здоровенное <em>SPA</em> приложение с несколькими сотнями контролов в сложной иерархии...</p>
<p>А пока - простейшее туду:</p>
<p><img src="../assets/blog/sapui5-state/basic-todo.png" alt="Запускаем — работает"></p>
<p>В представленном варианте: в модели <em>viewState</em> будет храниться объект со следующим содержанием:</p>
<div class="remark-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
    input<span class="token operator">:</span> <span class="token string">""</span>
    todos<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">"1592739272730"</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">"Раз"</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
        <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">"1592739273593"</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">"Два"</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
        <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">"1592739274600"</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">"Три"</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
        <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">"1592739276362"</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">"Четыре"</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
        <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">"1592739277545"</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">"Пять"</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p><a href="https://github.com/JustAddAcid/sapui5-todo">Репо с кодом</a></p>
<p>Продолжение следует.</p>
<p><a href="/tags/javascript">#javascript</a> <a href="/tags/sapui5">#sapui5</a></p>
</div></div></article><article class="mb-32 max-w-2xl mx-auto"><hr class="mb-5"/><h2 class="text-2xl md:text-2xl lg:text-2xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-center">Комментарии</h2><div class="md:flex p-6">Loading...</div><a href="https://github.com/JustAddAcid/JustAddAcid.github.io/issues/10" class="bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow mt-2 inline-block">Добавить комментарий</a></article></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5"></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Как запилить реактивность на SAPUI5 — часть 1","date":"2020-06-15T14:15:07.322Z","slug":"sapui5-state","author":{"name":"Roman A. Nosov","picture":"https://avatars3.githubusercontent.com/u/21103635?s=120\u0026v=4","url":"https://github.com/JustAddAcid"},"content":"\u003cp\u003eРешил описать то, как можно удобно хранить состояния экранов (или всего приложения) внутри \u003cem\u003eSAPUI5\u003c/em\u003e и делать реактивность (Почти как у больших и нормальных фреймворков).\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eДля тех, кто в танке и никогда не слышал, что это такое\u003c/strong\u003e \u003cem\u003eSAPUI5\u003c/em\u003e — это фронтенд-фреймворк. Как  хипстерские \u003cem\u003eVue\u003c/em\u003e и \u003cem\u003eReact\u003c/em\u003e, только никому не нужен. Используется для быстрого написания фронтендов поверх выгрузки данных из SAP-ERP. \u003c/p\u003e\n\u003cp\u003eВнезапно, но он действительно неплохо интегрирован со всей сап-экосистемой и простенькие приложения (внутри определенных рамок) писать не сильно больно. Проблемы начинаются тогда, когда нужно сделать что-то \u003cem\u003eбольшее\u003c/em\u003e, чем просто нарисовать табличку с двумя кнопками. И внезапно вылезают всеобщая громоздкость синтаксиса, нестабильность работы некоторых контролов и отсутствие нормального комьюнити.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"../assets/blog/sapui5-state/meme.png\" alt=\"Learning programming sapui5\"\u003e\u003c/p\u003e\n\u003ch2\u003eСтейты стейты стейты\u003c/h2\u003e\n\u003ch3\u003eДля начала немного теории\u003c/h3\u003e\n\u003cp\u003eЧто такое реактивное программирование очень хорошо объяснено \u003ca href=\"https://webdevblog.ru/ponimanie-reaktivnosti-vo-vue-js-shag-za-shagom/\"\u003eздесь\u003c/a\u003e только примеры для другого фреймворка. Но это не важно! :)\u003c/p\u003e\n\u003cp\u003eВ основе лежит идея о том, что было бы очень неплохо, если бы контролы сами смотрели в данные и \u003cstrong\u003eперестраивались\u003c/strong\u003e бы автоматически, если что-нибудь в этих данных поменяется, без кучи явных хендлеров и присвоений значений в контролы по многу раз. \u003c/p\u003e\n\u003cp\u003eИ наоборот — было бы неплохо, если бы данные \u003cstrong\u003eперестраивались\u003c/strong\u003e автоматически, если, например, в каком-нибудь input'e пользователь ввел другое значение.\u003c/p\u003e\n\u003ch4\u003eВот такой вот интересный \u003cstrong\u003etwo-way binding\u003c/strong\u003e ¯\\\u003cem\u003e(ツ)\u003c/em\u003e/¯\u003c/h4\u003e\n\u003cp\u003eДавайте человеческим языком — суть в том, что все данные у нас сложены в одну коробку (массив/объект) и все контролы на странице рендерятся на основе этих данных. \u003c/p\u003e\n\u003cp\u003eПлюсы здесь в том, что это, мать его, облегчает чтение и уменьшает размер нашего нелюбимого жабаскрипта. А чем меньше жабаскрипта — тем лучше.\u003c/p\u003e\n\u003cp\u003eА ещё сразу понятно, что приложение делает, если взглянуть на модель данных. А ещё это кодится быстрее за ту же зарплату. Ну вы понимаете.\u003c/p\u003e\n\u003ch3\u003eРазберем на практике избитый пример:\u003c/h3\u003e\n\u003ch4\u003eТудушница\u003c/h4\u003e\n\u003cp\u003eДавайте за минуту напишем простейший toDo-лист с единым хранением состояния. \u003c/p\u003e\n\u003cp\u003eДля начала создаём пустое \u003cem\u003eSAPUI5\u003c/em\u003e приложение с единственной view — \u003cem\u003eindex.view.xml\u003c/em\u003e, которая сразу при открытии будет отображаться пользователю. \u003c/p\u003e\n\u003cp\u003eИдем от данных! Какие данные примерно должна хранить todo-list? Наверное, массив заметок с полями: checked, text, и id. Ну и содержимое текстового поля, которое генерирует новые заметки. Получилось примерно вот так:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    input\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    todos\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// Тут будут объекты вот в таком формате:\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// \t{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// \tid: \"1\",\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// \ttext: \"one\",\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// \tchecked: true\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// }\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eСостояние в \u003cem\u003eSAPUI5\u003c/em\u003e лучше всего хранить в объекте класса sap.ui.model.json.\u003cstrong\u003eJSONModel\u003c/strong\u003e. Он позволяет подписываться на изменения каждого из свойства хранимого объекта, - как из XML-view в декларативном стиле, так и напрямую писать хендлеры изменений из кода. Почему класс называется именно JSONModel - для меня остаётся загадкой, т.к. де-факто он хранит обычный JavaScript объект.\u003c/p\u003e\n\u003cp\u003eОткрываем файл \u003cem\u003e/controller/index.controller.js\u003c/em\u003e и по событию инициализации создаём \u003cem\u003eJSON-model\u003c/em\u003e и заполняем её данными.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token function-variable function\"\u003eonInit\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eviewState\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eJSONModel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      input\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      todos\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetView\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003esetModel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eviewState\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"viewState\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eМодель присваивается к \u003cem\u003eView\u003c/em\u003e с помощью метода \u003cem\u003e.setModel\u003c/em\u003e. В данном конкретном случае псевдоним модели (\"\u003cem\u003eviewState\u003c/em\u003e\") можно было не указывать, т.к. модель всего одна и путаницы возникнуть не может. \u003c/p\u003e\n\u003cp\u003eДавайте попробуем представить, как бы у нас выглядел метод создания новой заметки:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token function-variable function\"\u003eappendTodo\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e todos \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eviewState\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetProperty\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/todos\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eviewState\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003esetProperty\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/todos\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003econcat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      id\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetTime\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003etoString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      text\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eviewState\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetProperty\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/input\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      checked\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eviewState\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003esetProperty\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/input\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eОчень просто. Получение массива заметок, создание массива со старыми + новой заметкой и присвоение его к модели. Затем очистка поля ввода.\u003c/p\u003e\n\u003cp\u003eВ качестве id нам пока вполне подойдет текущий таймстемп. Вместо Array.prototype.concat, если очень хочется, можно использовать ES6 spread operator:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e newArray \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token spread operator\"\u003e...\u003c/span\u003eoldArray\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e newElement\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eНо не очень нужно, т.к. у sapui5 из коробки нет никакого препроцессинга кода, а написанный энтузиастами плагин для Babel не для production-use. И используя фичи es6 мы автоматически делаем наш код неспособным запуститься на ie10-11 (а у некоторых он до сих пор — корпоративный стандарт).\u003c/p\u003e\n\u003cp\u003eПереходим к разметке интерфейса. Там всё просто: поле создания заметок + список.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-xml\"\u003e\u003ccode class=\"language-xml\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003econtent\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eInput\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003evalue\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{viewState\u003e/input}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003esubmit\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eappendTodo\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eList\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eitems\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{viewState\u003e/todos}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n      \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eitems\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCustomListItem\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n          \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eHBox\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n            \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCheckBox\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eselected\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{viewState\u003echecked}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n            \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eInput\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ewidth\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e500px\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003evalue\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{viewState\u003etext}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n            \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eButton\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003etext\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eX\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003epress\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003edeleteTodo\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003e\u003cspan class=\"token namespace\"\u003edata:\u003c/span\u003eid\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{viewState\u003eid}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n          \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eHBox\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eCustomListItem\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n      \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eitems\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eList\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003econtent\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eID заметки будем передавать в data-* атрибуте. (Чтобы неймспейс data: в разметке заработал, нужно его подключить в самом верху view)\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-xml\"\u003e\u003ccode class=\"language-xml\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token namespace\"\u003emvc:\u003c/span\u003eView\u003c/span\u003e \n  \u003cspan class=\"token attr-name\"\u003econtrollerName\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003etodoTodo.controller.index\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \n  \u003cspan class=\"token attr-name\"\u003e\u003cspan class=\"token namespace\"\u003exmlns:\u003c/span\u003ehtml\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ehttp://www.w3.org/1999/xhtml\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token attr-name\"\u003e\u003cspan class=\"token namespace\"\u003exmlns:\u003c/span\u003emvc\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003esap.ui.core.mvc\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n\t\u003cspan class=\"token attr-name\"\u003edisplayBlock\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003etrue\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \n  \u003cspan class=\"token attr-name\"\u003exmlns\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003esap.m\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \n  \u003cspan class=\"token attr-name\"\u003e\u003cspan class=\"token namespace\"\u003exmlns:\u003c/span\u003edata\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ehttp://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eМетод удаления заметки: Получаем id из data-* атрибута и фильтруем массив.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token function-variable function\"\u003edeleteTodo\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eevent\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e id \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e event\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetSource\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003edata\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e todos \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eviewState\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetProperty\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/todos\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eviewState\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003esetProperty\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/todos\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003efilter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003etodo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e todo\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eid\u003c/span\u003e \u003cspan class=\"token operator\"\u003e!==\u003c/span\u003e id\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eЗапускаем — работает! Написано всего два простых метода. \u003c/p\u003e\n\u003cp\u003eСейчас нам \u003cstrong\u003eничего\u003c/strong\u003e не стоит забрать данные и записать в \u003cem\u003elocalStorage\u003c/em\u003e браузера, или отправить на \u003cem\u003eсервер\u003c/em\u003e, или как-то обрабатывать в коде, т.к. мы всегда знаем, где находятся данные и как они организованы.\u003c/p\u003e\n\u003cp\u003eА теперь давайте представим, сколько бы нам потребовалось геморроя, если бы мы писали это в классическом html+js... Приходилось бы руками описывать хендлеры событий каждого контрола, а сборка данных для отправки на сервер превратилась бы в сущий ад в виде цикла по всем контролам и вытаскивания значения. Конечно, для данного примера этот аргумент звучит не слишком сурово. Но представьте здоровенное \u003cem\u003eSPA\u003c/em\u003e приложение с несколькими сотнями контролов в сложной иерархии...\u003c/p\u003e\n\u003cp\u003eА пока - простейшее туду:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"../assets/blog/sapui5-state/basic-todo.png\" alt=\"Запускаем — работает\"\u003e\u003c/p\u003e\n\u003cp\u003eВ представленном варианте: в модели \u003cem\u003eviewState\u003c/em\u003e будет храниться объект со следующим содержанием:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    input\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\n    todos\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e id\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"1592739272730\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e text\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Раз\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e checked\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e id\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"1592739273593\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e text\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Два\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e checked\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e id\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"1592739274600\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e text\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Три\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e checked\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e id\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"1592739276362\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e text\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Четыре\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e checked\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e id\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"1592739277545\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e text\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Пять\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e checked\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/JustAddAcid/sapui5-todo\"\u003eРепо с кодом\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eПродолжение следует.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/tags/javascript\"\u003e#javascript\u003c/a\u003e \u003ca href=\"/tags/sapui5\"\u003e#sapui5\u003c/a\u003e\u003c/p\u003e\n","ogImage":{"url":"/assets/blog/sapui5-state/cover2withHeader.png"},"coverImage":"/assets/blog/sapui5-state/cover2withHeader.png","issueId":"10"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"sapui5-state"},"buildId":"WGLPwn0mPPHoFJAY34UX7","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>