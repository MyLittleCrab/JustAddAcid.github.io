<!DOCTYPE html><html lang="ru"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="Nosoff.info — personal blog"/><title>Экспортируем нужные нам данные из openStreetMap</title><meta property="og:image" content="/assets/blog/exporting_data_form_osm/background.jpg"/><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/8989f9f4657d19f0fcdb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8989f9f4657d19f0fcdb.css" data-n-g=""/><link rel="preload" href="/_next/static/css/6dab348d518a0e6702e4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6dab348d518a0e6702e4.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-61095c13c5984b221292.js" defer=""></script><script src="/_next/static/chunks/framework-92300432a1172ef1338b.js" defer=""></script><script src="/_next/static/chunks/main-a3a79aff3ff232b41814.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f98b93c1570ecf70d9fa.js" defer=""></script><script src="/_next/static/chunks/853-ae4f3fbc7686be6d8798.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-27720eb20c91d7796fb9.js" defer=""></script><script src="/_next/static/WGLPwn0mPPHoFJAY34UX7/_buildManifest.js" defer=""></script><script src="/_next/static/WGLPwn0mPPHoFJAY34UX7/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen"><main><div class="container mx-auto px-5"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8"><a class="hover:underline" href="/">Nosoff.info</a></h2><article class="mb-32"><h1 class="screenreader">Экспортируем нужные нам данные из openStreetMap</h1><div class="hidden md:block md:mb-12"><a class="flex items-center" href="https://github.com/JustAddAcid"><img src="https://avatars3.githubusercontent.com/u/21103635?s=120&amp;v=4" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></a></div><div class="mb-8 md:mb-16 -mx-5 sm:mx-0"><div class="-mx-5 sm:mx-0"><img src="/assets/blog/exporting_data_form_osm/background.jpg" alt="Cover Image for Экспортируем нужные нам данные из openStreetMap" class="shadow-small"/></div></div><div class="max-w-2xl mx-auto"><div class="block md:hidden mb-6"><a class="flex items-center" href="https://github.com/JustAddAcid"><img src="https://avatars3.githubusercontent.com/u/21103635?s=120&amp;v=4" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></a></div><div class="mb-6 text-lg"><time dateTime="2020-07-05T14:15:07.322Z">July	5, 2020</time></div></div><div class="max-w-2xl mx-auto"><div class="markdown-styles_markdown__1x9gM"><p>Иногда возникает ситуация, в которой нам жизненно необходимо получить структурированные геоданные для своих проектов. Но где их искать? Делать на коленке парсер <em>google maps</em>?</p>
<p>На самом деле нет — всё куда прозаичнее. Их можно без зазрения совести скоммуниздить из прекрасного проекта <em>openStreetMaps</em>, попутно дополнив и исправив текущие данные в их базах.</p>
<p><strong>Краткая справка для тех, кто в танке:</strong> <em>openStreetMaps</em> (или кратко <em>OSM</em>) — <em>open source</em> картографический проект, где каждый пользователь может чуть-чуть дорисовать карту. И по принципу "с миру по нитке" собирается свободная и бесплатная карта мира. (как с википедией, только карта)</p>
<h2>Процесс раскулачивания геосервиса запущен</h2>
<p><img src="../assets/blog/exporting_data_form_osm/meme.jpg" alt="Псс, парень, не хочешь немного геоданных?"></p>
<p>Итак, в моём конкретном случае, мне нужно получить данные <strong>по всем железнодорожным станциям России</strong>: название, её код в какой-нибудь международной классификации + координаты. У вас это могут любые другие данные, принцип получения от этого толком не изменяется. </p>
<p>Для вытаскивания небольших данных из <em>OSM</em> есть онлайновый инструмент, который позволяет делать запросы и получать результат в <em>JSON</em>.</p>
<p>Но лично для меня этот язык запросов выглядит слишком странным + этот инструмент работает до невозможности медленно (а иногда благополучно лежит). <a href="https://overpass-turbo.eu/">overpass-turbo</a></p>
<p>Но можно пойти куда <strong>более простым и понятным</strong> путём:</p>
<ol>
<li>Скачать дамп всех данных <em>OSM</em> (или маленький кусочек нужной нам территории)</li>
<li>Отфильтровать объекты (оставить только те типы объектов, которые нам нужны)</li>
<li>Преобразовать в формат, который пригоден для загрузки в БД</li>
</ol>
<h2>Небольшая вставка теории:</h2>
<p>Чтобы придумать, как вытащить железнодорожные станции, нужно понимать, какие данные и с какой структурой там в принципе есть. </p>
<p>Есть очень хорошая <a href="https://habr.com/ru/post/146503/">вводная статья на хабре</a>.<br>
А также имеется <a href="https://wiki.openstreetmap.org/wiki/Map_Features">официальная дока</a>.</p>
<p><strong>Если кратко:</strong></p>
<p>Дамп данных из <em>OpenStreetMap</em> можно представить в виде здоровенного XML файла, который содержит в себе <del>помойку</del> большое скопление тэгов трёх типов:</p>
<ol>
<li>Точки (<strong>node</strong>)</li>
<li>Линии (<strong>way</strong>)</li>
<li>Отношения (<strong>relation</strong>)</li>
</ol>
<p>Внутри этих тэгов заполняется всякая информация о них в виде <strong>key:value</strong>.</p>
<p><strong>Например:</strong>
Давайте попробуем найти в интерфейсе <em>OSM</em> любую станцию и посмотреть, что там внутри.</p>
<p>Станция <strong>Шушары</strong> и её информация (слева в таблице):</p>
<p><img src="../assets/blog/exporting_data_form_osm/shushary.png" alt="Станция Шушары в интерфейсе"></p>
<p>Теперь посмотрим, как она выглядит в данных:</p>
<div class="remark-highlight"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>node</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1377619868<span class="token punctuation">"</span></span> <span class="token attr-name">lat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>59.8057985<span class="token punctuation">"</span></span> <span class="token attr-name">lon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30.3884693<span class="token punctuation">"</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>9<span class="token punctuation">"</span></span> <span class="token attr-name">timestamp</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2019-05-08T05:34:15Z<span class="token punctuation">"</span></span> <span class="token attr-name">changeset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>70007449<span class="token punctuation">"</span></span> <span class="token attr-name">uid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>474169<span class="token punctuation">"</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Yevgeny Gromov<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>esr:user<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>033004<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Шушары<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>railway<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>station<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>uic_ref<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2005166<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wikidata<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Q4528146<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wikipedia<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ru:Шушары (станция)<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>node</span><span class="token punctuation">></span></span>
</code></pre></div>
<p>Данные хранятся в виде</p>
<div class="remark-highlight"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>key<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>value<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 
</code></pre></div>
<p>внутри нашей точки <em>"Шушары"</em>. А координаты хранятся в атрибутах самого тега "node" (lat/lon).</p>
<p>Замечаем, что признак "железнодорожная станция" — это вот такой тэг. На него и будем ориентироваться, когда будем фильтровать данные:</p>
<div class="remark-highlight"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>railway<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>station<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
</code></pre></div>
<p>Окей, мы поняли структуру, поняли что нам надо. Но где данные, Лебовски?</p>
<p><img src="../assets/blog/exporting_data_form_osm/meme%20data.jpg" alt="Ваши данные будут храниться здесь"></p>
<h2>Добываем данные</h2>
<p>Если у вас достаточно свободного пространства на жестком диске — можете попробовать выкачать весь мир <a href="https://wiki.openstreetmap.org/wiki/Downloading_data">по официальным инструкциям</a>.</p>
<p>Либо можно зайти на сайт <a href="https://www.openstreetmap.org/">openStreetMap</a>, открыть на карте нужный квадрат и нажать на "Экспорт".</p>
<h3>У России другой путь</h3>
<p><strong>Проблема России в том</strong>, что она достаточно большая, чтобы экспорт в интерфейсе <em>openStreetMap</em> <strong>падал</strong> из-за слишком большого количества данных, но всё ещё достаточно маленькая, чтобы ради неё выкачивать весь мир!</p>
<p>Специально для таких извращенцев, как мы, некоторые люди подготавливают "нарезку" мира на удобоваримые куски:</p>
<ul>
<li>На <a href="https://download.geofabrik.de/">geofabrik.de</a> имеются нарезки по континентам</li>
<li>На <a href="https://needgeo.com/">needgeo.com</a> есть данные по странам пост-советского пространства.</li>
</ul>
<p>Последняя ссылка как раз нам очень пригодится! :) Выкачиваем оттуда файл RU.pbf (который весит сущие копейки — всего <strong>3GB</strong>)</p>
<h2>Обрабатываем данные</h2>
<p>Для обработки нам понадобятся две консольные утилиты: <strong>osmconvert</strong> и <strong>osmfilter</strong>.</p>
<p>В <em>debian/ubuntu</em> устанавливаются очень просто одной командой:</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> osmctools
</code></pre></div>
<p>Для остальных <em>ОС</em> имеются ссылки на бинарники на официальной wiki <a href="https://wiki.openstreetmap.org/wiki/Osmfilter">Osmfilter</a> <a href="https://wiki.openstreetmap.org/wiki/Osmconvert">Osmconvert</a>.</p>
<p>Во-первых, нам нужно распаковать скачанный файл <strong>.pbf</strong> в пригодный для фильтрации формат.</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash">osmconvert RU.pbf -o<span class="token operator">=</span>RU.o5m
</code></pre></div>
<p>На выходе получим файл RU.o5m, который занимает уже 6.2GB. (но это всё ещё бинарный не человеко-читаемый файл.)</p>
<p>Теперь отбрасываем всё лишнее, оставляя только точки с нужным там тегом (который мы нашли в предыдущих параграфах):</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash">osmfilter RU.o5m --keep<span class="token operator">=</span><span class="token string">"railway=station"</span> <span class="token operator">></span> stations.osm
</code></pre></div>
<p>Компьютер задумается на какое-то время, а затем заполнит файл <em>stations.osm</em>. Де-факто, уже почти всё. Мы на выходе получили <em>XML</em> файл со всеми нужными нам станциями (3Mb). </p>
<p><strong>Попробуем проверить данные:</strong>
Открываем в любом текстовом редакторе, который способен открывать большие текстовые файлы (vim), и бегло просматриваем станции:</p>
<p>И тут натыкаемся на станцию метро "Озерки". Что ж, формально — это жд, и формально — станция. Но не совсем то, что мне нужно. :)</p>
<div class="remark-highlight"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>node</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>96459081<span class="token punctuation">"</span></span> <span class="token attr-name">lat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>60.0354511<span class="token punctuation">"</span></span> <span class="token attr-name">lon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30.3210663<span class="token punctuation">"</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>24<span class="token punctuation">"</span></span> <span class="token attr-name">timestamp</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2020-01-08T22:53:32Z<span class="token punctuation">"</span></span> <span class="token attr-name">changeset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>79358758<span class="token punctuation">"</span></span> <span class="token attr-name">uid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>217225<span class="token punctuation">"</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span title="&#x26;" class="token entity">&#x26;#38;</span>ergio<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>colour<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blue<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layer<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-5<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Озерки<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name:de<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Oserki<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name:en<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Ozerki<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name:fi<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Ozerki<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name:ru<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Озерки<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>network<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Петербургский метрополитен<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>operator<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Петербургский метрополитен<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>public_transport<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>station<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>railway<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>station<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>station<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subway<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subway<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>yes<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transport<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subway<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wikidata<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Q2241386<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wikipedia<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ru:Озерки (станция метро)<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>node</span><span class="token punctuation">></span></span>
</code></pre></div>
<p>Видим там целых три тега, которые свидетельствуют о том, что это метро. (зачем такая избыточность?)</p>
<div class="remark-highlight"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>station<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subway<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subway<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>yes<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>tag</span> <span class="token attr-name">k</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transport<span class="token punctuation">"</span></span> <span class="token attr-name">v</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subway<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
</code></pre></div>
<p>Фильтруем по этим тегам:</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash">osmfilter stations.osm --drop<span class="token operator">=</span><span class="token string">"station=subway or subway=yes or transport=subway"</span> <span class="token operator">></span> not_subway.osm
</code></pre></div>
<p>Смотрим на выходной файл — выглядит так, словно успешно отфильтровали. Теперь осталось превратить xml файл в CSV, чтобы удобно залить в базу.</p>
<p>Смотрим на документацию по станциям и составляем список тегов, которые будем выводить в CSV:
<a href="https://wiki.openstreetmap.org/wiki/RU:Tag:railway%3Dstation">railway:stations</a></p>
<p><strong>Нужные нам столбцы:</strong> </p>
<ol>
<li>id</li>
<li>lat</li>
<li>lon</li>
<li>name</li>
<li>uic_ref — уникальный код железнодорожной станции, присваиваемый UIC (International Union of Railways, Международный союз железных дорог).</li>
<li>esr:user — уникальный код железнодорожной станции в Единой сетевой разметке (ЕСР, для станций Балтики и стран СНГ).</li>
</ol>
<p>Экспортируем (обратите внимание, что атрибуты самого <em>node</em> записываются через "@"):</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash">osmconvert not_subway.osm --all-to-nodes --csv<span class="token operator">=</span><span class="token string">"@id @lat @lon name uic_ref esr:user"</span> --csv<span class="token operator">=</span>headline <span class="token operator">></span> stations.csv
</code></pre></div>
<p>Теперь мы можем со спокойной совестью делать с этими данными, что душе угодно. Можем обрабатывать руками в <em>EXCEL</em>, можем залить в базу и использовать в своих разнообразных проектах. </p>
<p>Если найдете какие-то неточности в данных, очень рекомендуется исправить их не только у себя, а залить их также на саму <em>OpenStreetMap</em>. Так сказать, сделать свой маленький вклад в общее дело. :)</p>
<p>P.S. Мистическим образом, под железнодорожные станции ещё мимикрирует Волгоградский метротрам. Но его уже можно отфильтровать в итоговом CSV.</p>
<iframe frameborder="0" style="border:none;width:100%;height:180px;" width="100%" height="180" src="https://music.yandex.ru/iframe/#track/31840941/3867842">Слушайте <a href='https://music.yandex.ru/album/3867842/track/31840941'>У трамвая жизнь кривая. норвежская свекла</a>  —  <a href='https://music.yandex.ru/artist/3976133'>Ремонт Воды</a> на Яндекс.Музыке</iframe>
<p><a href="../assets/blog/exporting_data_form_osm/stations.csv">Итоговый CSV файл со станциями здесь.</a></p>
<p><a href="/tags/%D1%82%D0%B0%D0%BD%D1%86%D1%8B_%D1%81_%D0%B1%D1%83%D0%B1%D0%BD%D0%BE%D0%BC">#танцы<em>с</em>бубном</a> <a href="/tags/%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0_%D1%81_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D0%BC%D0%B8">#работа<em>с</em>данными</a></p>
</div></div></article><article class="mb-32 max-w-2xl mx-auto"><hr class="mb-5"/><h2 class="text-2xl md:text-2xl lg:text-2xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-center">Комментарии</h2><div class="md:flex p-6">Loading...</div><a href="https://github.com/JustAddAcid/JustAddAcid.github.io/issues/12" class="bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow mt-2 inline-block">Добавить комментарий</a></article></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5"></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Экспортируем нужные нам данные из openStreetMap","date":"2020-07-05T14:15:07.322Z","slug":"exporting_data_form_osm","author":{"name":"Roman A. Nosov","picture":"https://avatars3.githubusercontent.com/u/21103635?s=120\u0026v=4","url":"https://github.com/JustAddAcid"},"content":"\u003cp\u003eИногда возникает ситуация, в которой нам жизненно необходимо получить структурированные геоданные для своих проектов. Но где их искать? Делать на коленке парсер \u003cem\u003egoogle maps\u003c/em\u003e?\u003c/p\u003e\n\u003cp\u003eНа самом деле нет — всё куда прозаичнее. Их можно без зазрения совести скоммуниздить из прекрасного проекта \u003cem\u003eopenStreetMaps\u003c/em\u003e, попутно дополнив и исправив текущие данные в их базах.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eКраткая справка для тех, кто в танке:\u003c/strong\u003e \u003cem\u003eopenStreetMaps\u003c/em\u003e (или кратко \u003cem\u003eOSM\u003c/em\u003e) — \u003cem\u003eopen source\u003c/em\u003e картографический проект, где каждый пользователь может чуть-чуть дорисовать карту. И по принципу \"с миру по нитке\" собирается свободная и бесплатная карта мира. (как с википедией, только карта)\u003c/p\u003e\n\u003ch2\u003eПроцесс раскулачивания геосервиса запущен\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"../assets/blog/exporting_data_form_osm/meme.jpg\" alt=\"Псс, парень, не хочешь немного геоданных?\"\u003e\u003c/p\u003e\n\u003cp\u003eИтак, в моём конкретном случае, мне нужно получить данные \u003cstrong\u003eпо всем железнодорожным станциям России\u003c/strong\u003e: название, её код в какой-нибудь международной классификации + координаты. У вас это могут любые другие данные, принцип получения от этого толком не изменяется. \u003c/p\u003e\n\u003cp\u003eДля вытаскивания небольших данных из \u003cem\u003eOSM\u003c/em\u003e есть онлайновый инструмент, который позволяет делать запросы и получать результат в \u003cem\u003eJSON\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003eНо лично для меня этот язык запросов выглядит слишком странным + этот инструмент работает до невозможности медленно (а иногда благополучно лежит). \u003ca href=\"https://overpass-turbo.eu/\"\u003eoverpass-turbo\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eНо можно пойти куда \u003cstrong\u003eболее простым и понятным\u003c/strong\u003e путём:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eСкачать дамп всех данных \u003cem\u003eOSM\u003c/em\u003e (или маленький кусочек нужной нам территории)\u003c/li\u003e\n\u003cli\u003eОтфильтровать объекты (оставить только те типы объектов, которые нам нужны)\u003c/li\u003e\n\u003cli\u003eПреобразовать в формат, который пригоден для загрузки в БД\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003eНебольшая вставка теории:\u003c/h2\u003e\n\u003cp\u003eЧтобы придумать, как вытащить железнодорожные станции, нужно понимать, какие данные и с какой структурой там в принципе есть. \u003c/p\u003e\n\u003cp\u003eЕсть очень хорошая \u003ca href=\"https://habr.com/ru/post/146503/\"\u003eвводная статья на хабре\u003c/a\u003e.\u003cbr\u003e\nА также имеется \u003ca href=\"https://wiki.openstreetmap.org/wiki/Map_Features\"\u003eофициальная дока\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eЕсли кратко:\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eДамп данных из \u003cem\u003eOpenStreetMap\u003c/em\u003e можно представить в виде здоровенного XML файла, который содержит в себе \u003cdel\u003eпомойку\u003c/del\u003e большое скопление тэгов трёх типов:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eТочки (\u003cstrong\u003enode\u003c/strong\u003e)\u003c/li\u003e\n\u003cli\u003eЛинии (\u003cstrong\u003eway\u003c/strong\u003e)\u003c/li\u003e\n\u003cli\u003eОтношения (\u003cstrong\u003erelation\u003c/strong\u003e)\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eВнутри этих тэгов заполняется всякая информация о них в виде \u003cstrong\u003ekey:value\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eНапример:\u003c/strong\u003e\nДавайте попробуем найти в интерфейсе \u003cem\u003eOSM\u003c/em\u003e любую станцию и посмотреть, что там внутри.\u003c/p\u003e\n\u003cp\u003eСтанция \u003cstrong\u003eШушары\u003c/strong\u003e и её информация (слева в таблице):\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"../assets/blog/exporting_data_form_osm/shushary.png\" alt=\"Станция Шушары в интерфейсе\"\u003e\u003c/p\u003e\n\u003cp\u003eТеперь посмотрим, как она выглядит в данных:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-xml\"\u003e\u003ccode class=\"language-xml\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003enode\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eid\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e1377619868\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003elat\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e59.8057985\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003elon\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e30.3884693\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eversion\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e9\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e2019-05-08T05:34:15Z\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003echangeset\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e70007449\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003euid\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e474169\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003euser\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eYevgeny Gromov\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eesr:user\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e033004\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ename\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eШушары\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003erailway\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003estation\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003euic_ref\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e2005166\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ewikidata\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eQ4528146\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ewikipedia\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eru:Шушары (станция)\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003enode\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eДанные хранятся в виде\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-xml\"\u003e\u003ccode class=\"language-xml\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ekey\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003evalue\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eвнутри нашей точки \u003cem\u003e\"Шушары\"\u003c/em\u003e. А координаты хранятся в атрибутах самого тега \"node\" (lat/lon).\u003c/p\u003e\n\u003cp\u003eЗамечаем, что признак \"железнодорожная станция\" — это вот такой тэг. На него и будем ориентироваться, когда будем фильтровать данные:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-xml\"\u003e\u003ccode class=\"language-xml\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003erailway\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003estation\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eОкей, мы поняли структуру, поняли что нам надо. Но где данные, Лебовски?\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"../assets/blog/exporting_data_form_osm/meme%20data.jpg\" alt=\"Ваши данные будут храниться здесь\"\u003e\u003c/p\u003e\n\u003ch2\u003eДобываем данные\u003c/h2\u003e\n\u003cp\u003eЕсли у вас достаточно свободного пространства на жестком диске — можете попробовать выкачать весь мир \u003ca href=\"https://wiki.openstreetmap.org/wiki/Downloading_data\"\u003eпо официальным инструкциям\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eЛибо можно зайти на сайт \u003ca href=\"https://www.openstreetmap.org/\"\u003eopenStreetMap\u003c/a\u003e, открыть на карте нужный квадрат и нажать на \"Экспорт\".\u003c/p\u003e\n\u003ch3\u003eУ России другой путь\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eПроблема России в том\u003c/strong\u003e, что она достаточно большая, чтобы экспорт в интерфейсе \u003cem\u003eopenStreetMap\u003c/em\u003e \u003cstrong\u003eпадал\u003c/strong\u003e из-за слишком большого количества данных, но всё ещё достаточно маленькая, чтобы ради неё выкачивать весь мир!\u003c/p\u003e\n\u003cp\u003eСпециально для таких извращенцев, как мы, некоторые люди подготавливают \"нарезку\" мира на удобоваримые куски:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eНа \u003ca href=\"https://download.geofabrik.de/\"\u003egeofabrik.de\u003c/a\u003e имеются нарезки по континентам\u003c/li\u003e\n\u003cli\u003eНа \u003ca href=\"https://needgeo.com/\"\u003eneedgeo.com\u003c/a\u003e есть данные по странам пост-советского пространства.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eПоследняя ссылка как раз нам очень пригодится! :) Выкачиваем оттуда файл RU.pbf (который весит сущие копейки — всего \u003cstrong\u003e3GB\u003c/strong\u003e)\u003c/p\u003e\n\u003ch2\u003eОбрабатываем данные\u003c/h2\u003e\n\u003cp\u003eДля обработки нам понадобятся две консольные утилиты: \u003cstrong\u003eosmconvert\u003c/strong\u003e и \u003cstrong\u003eosmfilter\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eВ \u003cem\u003edebian/ubuntu\u003c/em\u003e устанавливаются очень просто одной командой:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token function\"\u003esudo\u003c/span\u003e \u003cspan class=\"token function\"\u003eapt\u003c/span\u003e \u003cspan class=\"token function\"\u003einstall\u003c/span\u003e osmctools\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eДля остальных \u003cem\u003eОС\u003c/em\u003e имеются ссылки на бинарники на официальной wiki \u003ca href=\"https://wiki.openstreetmap.org/wiki/Osmfilter\"\u003eOsmfilter\u003c/a\u003e \u003ca href=\"https://wiki.openstreetmap.org/wiki/Osmconvert\"\u003eOsmconvert\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eВо-первых, нам нужно распаковать скачанный файл \u003cstrong\u003e.pbf\u003c/strong\u003e в пригодный для фильтрации формат.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003eosmconvert RU.pbf -o\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eRU.o5m\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eНа выходе получим файл RU.o5m, который занимает уже 6.2GB. (но это всё ещё бинарный не человеко-читаемый файл.)\u003c/p\u003e\n\u003cp\u003eТеперь отбрасываем всё лишнее, оставляя только точки с нужным там тегом (который мы нашли в предыдущих параграфах):\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003eosmfilter RU.o5m --keep\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"railway=station\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e stations.osm\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eКомпьютер задумается на какое-то время, а затем заполнит файл \u003cem\u003estations.osm\u003c/em\u003e. Де-факто, уже почти всё. Мы на выходе получили \u003cem\u003eXML\u003c/em\u003e файл со всеми нужными нам станциями (3Mb). \u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eПопробуем проверить данные:\u003c/strong\u003e\nОткрываем в любом текстовом редакторе, который способен открывать большие текстовые файлы (vim), и бегло просматриваем станции:\u003c/p\u003e\n\u003cp\u003eИ тут натыкаемся на станцию метро \"Озерки\". Что ж, формально — это жд, и формально — станция. Но не совсем то, что мне нужно. :)\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-xml\"\u003e\u003ccode class=\"language-xml\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003enode\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eid\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e96459081\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003elat\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e60.0354511\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003elon\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e30.3210663\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eversion\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e24\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e2020-01-08T22:53:32Z\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003echangeset\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e79358758\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003euid\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e217225\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003euser\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003cspan title=\"\u0026#x26;\" class=\"token entity\"\u003e\u0026#x26;#38;\u003c/span\u003eergio\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ecolour\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eblue\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003elayer\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e-5\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ename\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eОзерки\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ename:de\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eOserki\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ename:en\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eOzerki\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ename:fi\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eOzerki\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ename:ru\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eОзерки\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003enetwork\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eПетербургский метрополитен\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eoperator\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eПетербургский метрополитен\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003epublic_transport\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003estation\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003erailway\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003estation\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003estation\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003esubway\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003esubway\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eyes\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003etransport\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003esubway\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ewikidata\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eQ2241386\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ewikipedia\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eru:Озерки (станция метро)\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003enode\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eВидим там целых три тега, которые свидетельствуют о том, что это метро. (зачем такая избыточность?)\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-xml\"\u003e\u003ccode class=\"language-xml\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003estation\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003esubway\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003esubway\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eyes\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etag\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ek\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003etransport\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ev\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003esubway\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eФильтруем по этим тегам:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003eosmfilter stations.osm --drop\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"station=subway or subway=yes or transport=subway\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e not_subway.osm\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eСмотрим на выходной файл — выглядит так, словно успешно отфильтровали. Теперь осталось превратить xml файл в CSV, чтобы удобно залить в базу.\u003c/p\u003e\n\u003cp\u003eСмотрим на документацию по станциям и составляем список тегов, которые будем выводить в CSV:\n\u003ca href=\"https://wiki.openstreetmap.org/wiki/RU:Tag:railway%3Dstation\"\u003erailway:stations\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eНужные нам столбцы:\u003c/strong\u003e \u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eid\u003c/li\u003e\n\u003cli\u003elat\u003c/li\u003e\n\u003cli\u003elon\u003c/li\u003e\n\u003cli\u003ename\u003c/li\u003e\n\u003cli\u003euic_ref — уникальный код железнодорожной станции, присваиваемый UIC (International Union of Railways, Международный союз железных дорог).\u003c/li\u003e\n\u003cli\u003eesr:user — уникальный код железнодорожной станции в Единой сетевой разметке (ЕСР, для станций Балтики и стран СНГ).\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eЭкспортируем (обратите внимание, что атрибуты самого \u003cem\u003enode\u003c/em\u003e записываются через \"@\"):\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003eosmconvert not_subway.osm --all-to-nodes --csv\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"@id @lat @lon name uic_ref esr:user\"\u003c/span\u003e --csv\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eheadline \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e stations.csv\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eТеперь мы можем со спокойной совестью делать с этими данными, что душе угодно. Можем обрабатывать руками в \u003cem\u003eEXCEL\u003c/em\u003e, можем залить в базу и использовать в своих разнообразных проектах. \u003c/p\u003e\n\u003cp\u003eЕсли найдете какие-то неточности в данных, очень рекомендуется исправить их не только у себя, а залить их также на саму \u003cem\u003eOpenStreetMap\u003c/em\u003e. Так сказать, сделать свой маленький вклад в общее дело. :)\u003c/p\u003e\n\u003cp\u003eP.S. Мистическим образом, под железнодорожные станции ещё мимикрирует Волгоградский метротрам. Но его уже можно отфильтровать в итоговом CSV.\u003c/p\u003e\n\u003ciframe frameborder=\"0\" style=\"border:none;width:100%;height:180px;\" width=\"100%\" height=\"180\" src=\"https://music.yandex.ru/iframe/#track/31840941/3867842\"\u003eСлушайте \u003ca href='https://music.yandex.ru/album/3867842/track/31840941'\u003eУ трамвая жизнь кривая. норвежская свекла\u003c/a\u003e  —  \u003ca href='https://music.yandex.ru/artist/3976133'\u003eРемонт Воды\u003c/a\u003e на Яндекс.Музыке\u003c/iframe\u003e\n\u003cp\u003e\u003ca href=\"../assets/blog/exporting_data_form_osm/stations.csv\"\u003eИтоговый CSV файл со станциями здесь.\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/tags/%D1%82%D0%B0%D0%BD%D1%86%D1%8B_%D1%81_%D0%B1%D1%83%D0%B1%D0%BD%D0%BE%D0%BC\"\u003e#танцы\u003cem\u003eс\u003c/em\u003eбубном\u003c/a\u003e \u003ca href=\"/tags/%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0_%D1%81_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D0%BC%D0%B8\"\u003e#работа\u003cem\u003eс\u003c/em\u003eданными\u003c/a\u003e\u003c/p\u003e\n","ogImage":{"url":"/assets/blog/exporting_data_form_osm/background.jpg"},"coverImage":"/assets/blog/exporting_data_form_osm/background.jpg","issueId":"12"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"exporting_data_form_osm"},"buildId":"WGLPwn0mPPHoFJAY34UX7","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>