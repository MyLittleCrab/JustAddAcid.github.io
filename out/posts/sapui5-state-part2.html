<!DOCTYPE html><html lang="ru"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="Nosoff.info — personal blog"/><title>Как запилить реактивность на SAPUI5 — часть 2</title><meta property="og:image" content="/assets/blog/sapui5-state-part2/backgroundWithHeader.png"/><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/8989f9f4657d19f0fcdb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8989f9f4657d19f0fcdb.css" data-n-g=""/><link rel="preload" href="/_next/static/css/6dab348d518a0e6702e4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6dab348d518a0e6702e4.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-61095c13c5984b221292.js" defer=""></script><script src="/_next/static/chunks/framework-92300432a1172ef1338b.js" defer=""></script><script src="/_next/static/chunks/main-a3a79aff3ff232b41814.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f98b93c1570ecf70d9fa.js" defer=""></script><script src="/_next/static/chunks/853-ae4f3fbc7686be6d8798.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-27720eb20c91d7796fb9.js" defer=""></script><script src="/_next/static/WGLPwn0mPPHoFJAY34UX7/_buildManifest.js" defer=""></script><script src="/_next/static/WGLPwn0mPPHoFJAY34UX7/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen"><main><div class="container mx-auto px-5"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8"><a class="hover:underline" href="/">Nosoff.info</a></h2><article class="mb-32"><h1 class="screenreader">Как запилить реактивность на SAPUI5 — часть 2</h1><div class="hidden md:block md:mb-12"><a class="flex items-center" href="https://github.com/JustAddAcid"><img src="https://avatars3.githubusercontent.com/u/21103635?s=120&amp;v=4" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></a></div><div class="mb-8 md:mb-16 -mx-5 sm:mx-0"><div class="-mx-5 sm:mx-0"><img src="/assets/blog/sapui5-state-part2/backgroundWithHeader.png" alt="Cover Image for Как запилить реактивность на SAPUI5 — часть 2" class="shadow-small"/></div></div><div class="max-w-2xl mx-auto"><div class="block md:hidden mb-6"><a class="flex items-center" href="https://github.com/JustAddAcid"><img src="https://avatars3.githubusercontent.com/u/21103635?s=120&amp;v=4" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></a></div><div class="mb-6 text-lg"><time dateTime="2020-06-21T14:15:07.322Z">June	21, 2020</time></div></div><div class="max-w-2xl mx-auto"><div class="markdown-styles_markdown__1x9gM"><p>С концептом реактивности в <em>SAPUI5</em> немного разобрались. Осталось углубиться в эту тему чуть-чуть подробнее: </p>
<ol>
<li>Разобраться с тем, что же такое <em>expression binding</em> и с чем его едят</li>
<li>А также ответить на вопрос — как подписываться на изменение <em>viewState</em> и выполнять по этому событию какой-либо код. </li>
</ol>
<p><img src="../assets/blog/sapui5-state-part2/%D0%B4%D0%BE%D0%B1%D1%80%D0%B0%20%D0%BF%D0%BE%D0%B5%D1%88%D1%8C.png" alt="Добра поешь"></p>
<h2>Что же такое expression binding и с чем его едят</h2>
<p>В прошлой статье я немного рассказывал о реактивности в <em>sapui5</em> и показывал пример привязки элементов экрана к данным. Если ещё не читали, то <a href="./sapui5-state">добро пожаловать сюда</a>.</p>
<p>В тех примерах байндинги описывались прямо в xml верстке. Примерно в таком формате:</p>
<div class="remark-highlight"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>Control</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{modelName>modelProp}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
</code></pre></div>
<p>В этом случае в свойство контрола автоматически будет попадать значение из модели и автоматически обновляться, если данные в модели изменились.</p>
<p>Но это далеко не всё, что мы можем описать прямо во вью в декларативном стиле. Например, в некоторых ситуациях очень нужно именно <strong>вычислять</strong> значение поля на основании данных в модели, а не просто показывать какое-то значение.</p>
<p><strong>Возможные сценарии:</strong></p>
<ol>
<li>Подкрашивать красным строки таблицы, где значение какого-нибудь столбца меньше нуля</li>
<li>Активировать/деактивировать на основании данных кнопки</li>
<li>Выводить количество записей в массиве и т.д.</li>
</ol>
<p><em>Ремарка: сейчас речь пойдет только про </em>expression binding<em>. Про форматтеры поговорим как-нибудь в другой раз.</em></p>
<p>И такой функционал вычисления свойств <em>sapui5</em> нам охотно может предоставить.</p>
<div class="remark-highlight"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>Control</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{= JS_CODE}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
</code></pre></div>
<p>Всё это выглядит следующим образом: сразу после открывающейся фигурной скобки вставляем знак равенства, так парсер понимает, что дальше будет какое-то вычисляемое поле на <em>js</em>. Далее можно поместить маленький кусок кода на <em>javaScript</em>, который будет выполняться при вычислении содержимого поля. </p>
<p><em>(Вставлять туда можно константы, вызовы функций, тренарные?операторы:, регэкспы и прочие прелести жизни.)</em></p>
<p>Главное — не переусердствовать и не превратить разметку страницы в помойку. :)</p>
<p>Ссылаться на содержимое модели можно с помощью конструкции <strong>${}</strong>. Например: </p>
<div class="remark-highlight"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>Text</span> <span class="token attr-name">text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{= <span class="token punctuation">'</span>Hello, <span class="token punctuation">'</span> + ${user>name}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
</code></pre></div>
<p>В данном случае после <em>"Hello, "</em> будет подставлено <em>"name"</em> из модели <em>"user"</em>. И если в будущем поле <strong>user>name</strong> изменится — автоматически произойдет повторное вычисление всех <em>expression bindings</em>, связанных с этим полем.</p>
<p><strong>Ахтунг:</strong>
Будьте внимательны с <em>boolean</em>-атрибутами! </p>
<div class="remark-highlight"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>Button</span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{= someFunction( ${model>prop} )}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
</code></pre></div>
<p>В примере выше значение <em>enabled</em> (с типом <em>bool</em>) принимается из результата функции <em>someFunction</em>. Но если по каким-то причинам из функции возвратится <strong>undefined</strong>, то это значение <strong>не будет</strong> воспринято как <em>falsy</em> (как во всём остальном js), а мистическим образом конвертируется в <strong>true</strong>. Так что, конкретно в этом случае, может быть оправдана вот такая грязная и некрасивая запись (за которую вас могут ударить по рукам):</p>
<div class="remark-highlight"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>Button</span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{= !!someFunction( ${model>prop} )}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token comment">&#x3C;!-- или --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>Button</span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{= someFunction( ${model>prop} ) ? true : false }<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
</code></pre></div>
<p>Попробую привести более полные и понятные примеры того, где эти <em>expression bindings</em> можно удобно использовать:</p>
<h3>Раскрывающееся меню</h3>
<p>Допустим, нам требуется выпадающее меню вот с таким поведением: при нажатии на toggleButton должна меняться иконка и открываться дочерняя ветка меню. Как это сделать, почти не прибегая к <em>javaScript</em>?</p>
<p><img src="../assets/blog/sapui5-state-part2/menu%20closed.png" alt="menu closed">
<img src="../assets/blog/sapui5-state-part2/menu%20opened.png" alt="menu opened"></p>
<p>Очень просто: использовать для иконок тренарный оператор, который будет вычислять нужную нам иконку. А "дочернюю" ветку меню заключить в блок, который делать видимым тогда, когда свойство TransportEnabled в модели будет = true.</p>
<p>Пример верстки:</p>
<div class="remark-highlight"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>VBox</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>ToggleButton</span> <span class="token attr-name">text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Движение транспорта<span class="token punctuation">"</span></span>
    <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{= ${/TransportEnabled} ? <span class="token punctuation">'</span>иконка вкл<span class="token punctuation">'</span> : <span class="token punctuation">'</span>иконка выкл<span class="token punctuation">'</span><span class="token punctuation">"</span></span>
    <span class="token attr-name">pressed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{/TransportEnabled}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>VBox</span> <span class="token attr-name">visible</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{/TransportEnabled}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>ToggleButton</span> <span class="token attr-name">text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>В пути<span class="token punctuation">"</span></span> 
      <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{= ${/TransportOnWay} ? <span class="token punctuation">'</span>иконка вкл<span class="token punctuation">'</span> : <span class="token punctuation">'</span>иконка выкл<span class="token punctuation">'</span>}<span class="token punctuation">"</span></span>
      <span class="token attr-name">pressed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{/TransportOnWay}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>ToggleButton</span> <span class="token attr-name">text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>На подходе<span class="token punctuation">"</span></span>
      <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{= ${/TransportApproaching} ? <span class="token punctuation">'</span>иконка вкл<span class="token punctuation">'</span> : <span class="token punctuation">'</span>иконка выкл<span class="token punctuation">'</span>}<span class="token punctuation">"</span></span>
      <span class="token attr-name">pressed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{/TransportApproaching}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>ToggleButton</span> <span class="token attr-name">text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Прибыл<span class="token punctuation">"</span></span> 
      <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{= ${/TransportArrived} ? <span class="token punctuation">'</span>иконка вкл<span class="token punctuation">'</span> : <span class="token punctuation">'</span>иконка выкл<span class="token punctuation">'</span>}<span class="token punctuation">"</span></span>
      <span class="token attr-name">pressed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{/TransportArrived}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>VBox</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>VBox</span><span class="token punctuation">></span></span>
</code></pre></div>
<h3>Калькулятор</h3>
<p>Допустим, мы захотели написать простой калькулятор на <em>sapui5</em>. Как нам организовать блокировку кнопки "decimal point", когда точка уже введена пользователем? </p>
<p><img src="../assets/blog/sapui5-state-part2/calc%20before.png" alt="calc before">
<img src="../assets/blog/sapui5-state-part2/calc%20after.png" alt="calc after"></p>
<p><em>Не сильно заметно, но на втором скрине кнопка с точкой заблокирована</em></p>
<p>Можно писать отдельный метод проверки, а можно сделать вот так:</p>
<div class="remark-highlight"><pre class="language-xml"><code class="language-xml"><span class="token comment">&#x3C;!-- Само поле ввода чисел в калькулятор --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>Input</span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{viewState>/input}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>

<span class="token comment">&#x3C;!-- ... --></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>Button</span> <span class="token attr-name">text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.<span class="token punctuation">"</span></span> 
  <span class="token attr-name">press</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>appendSymbolToLine<span class="token punctuation">"</span></span> 
  <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{= !${viewState>/input}.includes(<span class="token punctuation">'</span>.<span class="token punctuation">'</span>) }<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
</code></pre></div>
<p>Просто проверять, есть ли в строке ввода точки :)</p>
<p><strong>И напоследок расскажу, как привязывать хендлеры к изменению конкретного свойства в JSON-модели:</strong></p>
<p>Хитрость заключается в том, что если для этого мы будем использовать класс <strong>sap.ui.model.Binding</strong>, то у нас ничего хорошего не получится. Т.к. хендлер будет запускаться каждый раз, когда изменится <strong>вообще какое-либо</strong> поле в этой модели. </p>
<p>А для привязки к конкретному полю существует специальный класс: <strong>sap.ui.model.json.JSONPropertyBinding</strong>.</p>
<p>Давайте прикрутим к нашему калькулятору какой-нибудь хендлер изменения данных в модели. Например, будем рисовать toast-сообщение при записи значения в память нашего калькулятора (при нажатии кнопок M+ и M-)</p>
<p>Для удобства напишем метод, который будет принимать два аргумента: путь до данных в модели, за которыми будем наблюдать, и функцию, которая будет запускаться при изменении этого поля:</p>
<div class="remark-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token function-variable function">addViewStateListener</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> oBinding <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">sap<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>model<span class="token punctuation">.</span>json<span class="token punctuation">.</span>JSONPropertyBinding</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">viewState</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    oBinding<span class="token punctuation">.</span><span class="token method function property-access">attachChange</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div>
<p>Затем напишем функцию, вызывающую сообщение и привяжем её к данным</p>
<div class="remark-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token function-variable function">memoryUsage</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    sap<span class="token punctuation">.</span><span class="token property-access">m</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">MessageToast</span></span><span class="token punctuation">.</span><span class="token method function property-access">show</span><span class="token punctuation">(</span><span class="token string">"Memory usage! Set "</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token method function property-access">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token comment">// [....]</span>
  <span class="token function-variable function">onInit</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// [....]</span>
  <span class="token comment">// При инициализации привязываем нашу функцию к проперти модели</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">addViewStateListener</span><span class="token punctuation">(</span><span class="token string">"/memory"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">memoryUsage</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Готово! При нажатии на m+ получаем вот такое сообщение:</p>
<p><img src="../assets/blog/sapui5-state-part2/calc_handler.jpg" alt="Calc handler"></p>
<p>Как всегда, код примера <a href="https://github.com/JustAddAcid/sapui5-calculator">вот здесь</a></p>
<p>Ещё увидимся</p>
<p><a href="/tags/javascript">#javascript</a> <a href="/tags/sapui5">#sapui5</a> </p>
</div></div></article><article class="mb-32 max-w-2xl mx-auto"><hr class="mb-5"/><h2 class="text-2xl md:text-2xl lg:text-2xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-center">Комментарии</h2><div class="md:flex p-6">Loading...</div><a href="https://github.com/JustAddAcid/JustAddAcid.github.io/issues/11" class="bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow mt-2 inline-block">Добавить комментарий</a></article></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5"></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Как запилить реактивность на SAPUI5 — часть 2","date":"2020-06-21T14:15:07.322Z","slug":"sapui5-state-part2","author":{"name":"Roman A. Nosov","picture":"https://avatars3.githubusercontent.com/u/21103635?s=120\u0026v=4","url":"https://github.com/JustAddAcid"},"content":"\u003cp\u003eС концептом реактивности в \u003cem\u003eSAPUI5\u003c/em\u003e немного разобрались. Осталось углубиться в эту тему чуть-чуть подробнее: \u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eРазобраться с тем, что же такое \u003cem\u003eexpression binding\u003c/em\u003e и с чем его едят\u003c/li\u003e\n\u003cli\u003eА также ответить на вопрос — как подписываться на изменение \u003cem\u003eviewState\u003c/em\u003e и выполнять по этому событию какой-либо код. \u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"../assets/blog/sapui5-state-part2/%D0%B4%D0%BE%D0%B1%D1%80%D0%B0%20%D0%BF%D0%BE%D0%B5%D1%88%D1%8C.png\" alt=\"Добра поешь\"\u003e\u003c/p\u003e\n\u003ch2\u003eЧто же такое expression binding и с чем его едят\u003c/h2\u003e\n\u003cp\u003eВ прошлой статье я немного рассказывал о реактивности в \u003cem\u003esapui5\u003c/em\u003e и показывал пример привязки элементов экрана к данным. Если ещё не читали, то \u003ca href=\"./sapui5-state\"\u003eдобро пожаловать сюда\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eВ тех примерах байндинги описывались прямо в xml верстке. Примерно в таком формате:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-xml\"\u003e\u003ccode class=\"language-xml\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eControl\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eproperty\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{modelName\u003emodelProp}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eВ этом случае в свойство контрола автоматически будет попадать значение из модели и автоматически обновляться, если данные в модели изменились.\u003c/p\u003e\n\u003cp\u003eНо это далеко не всё, что мы можем описать прямо во вью в декларативном стиле. Например, в некоторых ситуациях очень нужно именно \u003cstrong\u003eвычислять\u003c/strong\u003e значение поля на основании данных в модели, а не просто показывать какое-то значение.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eВозможные сценарии:\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eПодкрашивать красным строки таблицы, где значение какого-нибудь столбца меньше нуля\u003c/li\u003e\n\u003cli\u003eАктивировать/деактивировать на основании данных кнопки\u003c/li\u003e\n\u003cli\u003eВыводить количество записей в массиве и т.д.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cem\u003eРемарка: сейчас речь пойдет только про \u003c/em\u003eexpression binding\u003cem\u003e. Про форматтеры поговорим как-нибудь в другой раз.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eИ такой функционал вычисления свойств \u003cem\u003esapui5\u003c/em\u003e нам охотно может предоставить.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-xml\"\u003e\u003ccode class=\"language-xml\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eControl\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eproperty\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{= JS_CODE}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eВсё это выглядит следующим образом: сразу после открывающейся фигурной скобки вставляем знак равенства, так парсер понимает, что дальше будет какое-то вычисляемое поле на \u003cem\u003ejs\u003c/em\u003e. Далее можно поместить маленький кусок кода на \u003cem\u003ejavaScript\u003c/em\u003e, который будет выполняться при вычислении содержимого поля. \u003c/p\u003e\n\u003cp\u003e\u003cem\u003e(Вставлять туда можно константы, вызовы функций, тренарные?операторы:, регэкспы и прочие прелести жизни.)\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eГлавное — не переусердствовать и не превратить разметку страницы в помойку. :)\u003c/p\u003e\n\u003cp\u003eСсылаться на содержимое модели можно с помощью конструкции \u003cstrong\u003e${}\u003c/strong\u003e. Например: \u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-xml\"\u003e\u003ccode class=\"language-xml\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eText\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003etext\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{= \u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003eHello, \u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003e + ${user\u003ename}}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eВ данном случае после \u003cem\u003e\"Hello, \"\u003c/em\u003e будет подставлено \u003cem\u003e\"name\"\u003c/em\u003e из модели \u003cem\u003e\"user\"\u003c/em\u003e. И если в будущем поле \u003cstrong\u003euser\u003ename\u003c/strong\u003e изменится — автоматически произойдет повторное вычисление всех \u003cem\u003eexpression bindings\u003c/em\u003e, связанных с этим полем.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eАхтунг:\u003c/strong\u003e\nБудьте внимательны с \u003cem\u003eboolean\u003c/em\u003e-атрибутами! \u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-xml\"\u003e\u003ccode class=\"language-xml\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eButton\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eenabled\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{= someFunction( ${model\u003eprop} )}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eВ примере выше значение \u003cem\u003eenabled\u003c/em\u003e (с типом \u003cem\u003ebool\u003c/em\u003e) принимается из результата функции \u003cem\u003esomeFunction\u003c/em\u003e. Но если по каким-то причинам из функции возвратится \u003cstrong\u003eundefined\u003c/strong\u003e, то это значение \u003cstrong\u003eне будет\u003c/strong\u003e воспринято как \u003cem\u003efalsy\u003c/em\u003e (как во всём остальном js), а мистическим образом конвертируется в \u003cstrong\u003etrue\u003c/strong\u003e. Так что, конкретно в этом случае, может быть оправдана вот такая грязная и некрасивая запись (за которую вас могут ударить по рукам):\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-xml\"\u003e\u003ccode class=\"language-xml\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eButton\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eenabled\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{= !!someFunction( ${model\u003eprop} )}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e\u0026#x3C;!-- или --\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eButton\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eenabled\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{= someFunction( ${model\u003eprop} ) ? true : false }\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eПопробую привести более полные и понятные примеры того, где эти \u003cem\u003eexpression bindings\u003c/em\u003e можно удобно использовать:\u003c/p\u003e\n\u003ch3\u003eРаскрывающееся меню\u003c/h3\u003e\n\u003cp\u003eДопустим, нам требуется выпадающее меню вот с таким поведением: при нажатии на toggleButton должна меняться иконка и открываться дочерняя ветка меню. Как это сделать, почти не прибегая к \u003cem\u003ejavaScript\u003c/em\u003e?\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"../assets/blog/sapui5-state-part2/menu%20closed.png\" alt=\"menu closed\"\u003e\n\u003cimg src=\"../assets/blog/sapui5-state-part2/menu%20opened.png\" alt=\"menu opened\"\u003e\u003c/p\u003e\n\u003cp\u003eОчень просто: использовать для иконок тренарный оператор, который будет вычислять нужную нам иконку. А \"дочернюю\" ветку меню заключить в блок, который делать видимым тогда, когда свойство TransportEnabled в модели будет = true.\u003c/p\u003e\n\u003cp\u003eПример верстки:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-xml\"\u003e\u003ccode class=\"language-xml\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eVBox\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eToggleButton\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003etext\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eДвижение транспорта\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token attr-name\"\u003eicon\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{= ${/TransportEnabled} ? \u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003eиконка вкл\u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003e : \u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003eиконка выкл\u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token attr-name\"\u003epressed\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{/TransportEnabled}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eVBox\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003evisible\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{/TransportEnabled}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eToggleButton\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003etext\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eВ пути\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \n      \u003cspan class=\"token attr-name\"\u003eicon\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{= ${/TransportOnWay} ? \u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003eиконка вкл\u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003e : \u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003eиконка выкл\u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003e}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n      \u003cspan class=\"token attr-name\"\u003epressed\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{/TransportOnWay}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eToggleButton\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003etext\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eНа подходе\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n      \u003cspan class=\"token attr-name\"\u003eicon\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{= ${/TransportApproaching} ? \u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003eиконка вкл\u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003e : \u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003eиконка выкл\u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003e}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n      \u003cspan class=\"token attr-name\"\u003epressed\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{/TransportApproaching}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eToggleButton\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003etext\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eПрибыл\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \n      \u003cspan class=\"token attr-name\"\u003eicon\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{= ${/TransportArrived} ? \u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003eиконка вкл\u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003e : \u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003eиконка выкл\u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003e}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n      \u003cspan class=\"token attr-name\"\u003epressed\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{/TransportArrived}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eVBox\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eVBox\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3\u003eКалькулятор\u003c/h3\u003e\n\u003cp\u003eДопустим, мы захотели написать простой калькулятор на \u003cem\u003esapui5\u003c/em\u003e. Как нам организовать блокировку кнопки \"decimal point\", когда точка уже введена пользователем? \u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"../assets/blog/sapui5-state-part2/calc%20before.png\" alt=\"calc before\"\u003e\n\u003cimg src=\"../assets/blog/sapui5-state-part2/calc%20after.png\" alt=\"calc after\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eНе сильно заметно, но на втором скрине кнопка с точкой заблокирована\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eМожно писать отдельный метод проверки, а можно сделать вот так:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-xml\"\u003e\u003ccode class=\"language-xml\"\u003e\u003cspan class=\"token comment\"\u003e\u0026#x3C;!-- Само поле ввода чисел в калькулятор --\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eInput\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eenabled\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003efalse\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003evalue\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{viewState\u003e/input}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e\u0026#x3C;!-- ... --\u003e\u003c/span\u003e\n\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eButton\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003etext\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e.\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \n  \u003cspan class=\"token attr-name\"\u003epress\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eappendSymbolToLine\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \n  \u003cspan class=\"token attr-name\"\u003eenabled\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e{= !${viewState\u003e/input}.includes(\u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003e.\u003cspan class=\"token punctuation\"\u003e'\u003c/span\u003e) }\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eПросто проверять, есть ли в строке ввода точки :)\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eИ напоследок расскажу, как привязывать хендлеры к изменению конкретного свойства в JSON-модели:\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eХитрость заключается в том, что если для этого мы будем использовать класс \u003cstrong\u003esap.ui.model.Binding\u003c/strong\u003e, то у нас ничего хорошего не получится. Т.к. хендлер будет запускаться каждый раз, когда изменится \u003cstrong\u003eвообще какое-либо\u003c/strong\u003e поле в этой модели. \u003c/p\u003e\n\u003cp\u003eА для привязки к конкретному полю существует специальный класс: \u003cstrong\u003esap.ui.model.json.JSONPropertyBinding\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eДавайте прикрутим к нашему калькулятору какой-нибудь хендлер изменения данных в модели. Например, будем рисовать toast-сообщение при записи значения в память нашего калькулятора (при нажатии кнопок M+ и M-)\u003c/p\u003e\n\u003cp\u003eДля удобства напишем метод, который будет принимать два аргумента: путь до данных в модели, за которыми будем наблюдать, и функцию, которая будет запускаться при изменении этого поля:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token function-variable function\"\u003eaddViewStateListener\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003epath\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e callback\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e oBinding \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003esap\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eui\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejson\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eJSONPropertyBinding\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eviewState\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e path\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    oBinding\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eattachChange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecallback\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eЗатем напишем функцию, вызывающую сообщение и привяжем её к данным\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token function-variable function\"\u003ememoryUsage\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eevent\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    sap\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003em\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003e\u003cspan class=\"token maybe-class-name\"\u003eMessageToast\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eshow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Memory usage! Set \"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e event\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetSource\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetValue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// [....]\u003c/span\u003e\n  \u003cspan class=\"token function-variable function\"\u003eonInit\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// [....]\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// При инициализации привязываем нашу функцию к проперти модели\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eaddViewStateListener\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/memory\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ememoryUsage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eГотово! При нажатии на m+ получаем вот такое сообщение:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"../assets/blog/sapui5-state-part2/calc_handler.jpg\" alt=\"Calc handler\"\u003e\u003c/p\u003e\n\u003cp\u003eКак всегда, код примера \u003ca href=\"https://github.com/JustAddAcid/sapui5-calculator\"\u003eвот здесь\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eЕщё увидимся\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/tags/javascript\"\u003e#javascript\u003c/a\u003e \u003ca href=\"/tags/sapui5\"\u003e#sapui5\u003c/a\u003e \u003c/p\u003e\n","ogImage":{"url":"/assets/blog/sapui5-state-part2/backgroundWithHeader.png"},"coverImage":"/assets/blog/sapui5-state-part2/backgroundWithHeader.png","issueId":"11"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"sapui5-state-part2"},"buildId":"WGLPwn0mPPHoFJAY34UX7","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>