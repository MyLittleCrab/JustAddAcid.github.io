{"pageProps":{"post":{"title":"Подключаем сторонние шрифты с иконками к SAPUI5-приложению","date":"2020-09-26T17:08:30.259Z","slug":"sapui5-connect-icons-font","author":{"name":"Roman A. Nosov","picture":"https://avatars3.githubusercontent.com/u/21103635?s=120&v=4","url":"https://github.com/JustAddAcid"},"content":"<p>Привет, мои маленькие любители лёгкого <em>БДСМ</em>. В эфире передача \"веселые истории с <em>SAPUI5</em>\". И сегодня мы рассмотрим, какие шаги нужно проделать, чтобы подключить шрифт с нужными нам иконками и использовать их при построении интерфейса. Тому що список стандартных иконок очень куцый, и иногда нужно добавить что-нибудь со стороны.</p>\n<p>Как и всегда это бывает в айтишечке, мы можем решить эту задачу целыми <em>двумя</em> способами:</p>\n<p><strong>Первый</strong> — найти нормальную работу, и не маяться ерундой.</p>\n<p><img src=\"../assets/blog/sapui5-connect-icons-font/work_meme.jpg\" alt=\"Нормальная работа\"></p>\n<p><strong>Второй</strong> (сложнее, но не сильно) — описан ниже.</p>\n<h2>Немного теории</h2>\n<p>На <a href=\"https://sapui5.hana.ondemand.com/#/entity/sap.ui.core.Icon/sample/sap.ui.core.sample.Icon\">официальном демо-примере</a> можем посмотреть как работают нативные иконки в этом фреймворке. </p>\n<p>С точки зрения кода, иконки представлены классом sap.ui.core.<strong>Icon</strong>, остальные элементы экрана, в которых есть иконки, либо расширяют этот класс, либо содержат его внутри себя. Его конструктор принимает следующие основные аргументы:</p>\n<div class=\"remark-highlight\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token namespace\">core:</span>Icon</span>\n  <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sap-icon://syringe<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">путь</span> <span class=\"token attr-name\">до</span> <span class=\"token attr-name\">иконки</span> <span class=\"token attr-name\">с</span> <span class=\"token attr-name\">протоколом</span> <span class=\"token attr-name\">sap-icon</span>\n  <span class=\"token attr-name\">color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#031E48<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span> цвет\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span><span class=\"token namespace\">core:</span>Icon</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>И всё это чудо преобразовывается в следующую конструкцию при запуске:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>span</span> \n  <span class=\"token attr-name\">role</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>presentation<span class=\"token punctuation\">\"</span></span> \n  <span class=\"token attr-name\">aria-hidden</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> \n  <span class=\"token attr-name\">aria-label</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>syringe<span class=\"token punctuation\">\"</span></span> \n  <span class=\"token attr-name\">data-sap-ui-icon-content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> \n  <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sapUiIcon sapUiIconMirrorInRTL<span class=\"token punctuation\">\"</span></span> \n  <span class=\"token style-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token style language-css\"><span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'SAP\\2dicons'</span><span class=\"token punctuation\">;</span> <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> <span class=\"token hexcode color\">#031E48</span><span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span>\n  ::before\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>span</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p><em>SPAN</em>, в котором в аттрибуте style явно объявлен нативный шрифт с иконками, и цвет, заданный в XML-конструкторе. Сам символ иконки лежит в аттрибуте <em>data-sap-ui-icon-content</em>, который с помощью <em>css</em> подставляется внутрь псеводэлемента <em>::before</em>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\"><span class=\"token class\">.sapUiIcon</span><span class=\"token pseudo-element\">::before</span></span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token function\">attr</span><span class=\"token punctuation\">(</span>data-sap-ui-icon-content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">speak</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">font-weight</span><span class=\"token punctuation\">:</span> normal<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Зачем я это написал? Непонятно, т.к. в этой информации нет ничего полезного. </p>\n<p><img src=\"../assets/blog/sapui5-connect-icons-font/%D0%B4%D0%BB%D1%8F%20%D0%BE%D0%B1%D1%89%D0%B5%D0%B3%D0%BE%20%D1%80%D0%B0%D0%B7%D0%B2%D0%B8%D1%82%D0%B8%D1%8F.jpg\" alt=\"Для общего развития\"></p>\n<p>Первым делом делаем что? Праавильно! <a href=\"https://help.sap.com/saphelp_uiaddon10/helpdata/en/21/ea0ea94614480d9a910b2e93431291/content.htm?no_cache=true\">Лезем в доку</a>, где индусским по белому написано, что для использования кастомных шрифтов иконок нужно сделать несколько очень простых телодвижений:</p>\n<ol>\n<li>Объявить <em>font-face</em> с нашими шрифтами в <em>css</em></li>\n<li><strong>Каждую</strong> иконку, которую мы хотим использовать, нужно объявить с помощью метода sap.ui.core.IconPool.<strong>addIcon</strong>(iconName, collectionName, fontFamily, content)</li>\n<li>Ссылаться в на объявленные иконки во всех местах, где очень чешется по следующему принципу: <strong>sap-icon</strong>://[<strong>collection-name</strong>]/[<strong>icon-name</strong>]</li>\n</ol>\n<p>На этом можно было заканчивать, но давайте пример.</p>\n<h2>Пример</h2>\n<p>Для начала нам нужен какой-нибудь шрифт с иконками. Можно запаковать любые свои векторные изображения в шрифт, если очень хочется. Благо, для этого существует бесконечное количество утилит. Гуглите. </p>\n<p>Я для примера буду пользовать готовую сборку иконок от <a href=\"https://fontawesome.com\">fontawesome</a>. Залезаем, качаем архив с исходниками. В бесплатной версии нам доступны только шрифты: <strong>brands</strong>, <strong>regular</strong>, <strong>solid</strong>.</p>\n<p>В директории <em>/webfonts</em> собраны эти три шрифта в разных форматах. (Чтобы покрыть все популярные браузеры) -> Копируем эту директорию в корень нашего проекта. </p>\n<p>Далее, идем по официальной инструкции:</p>\n<p>Чтобы объявить шрифты из <em>fontawesome</em> нужно с каждым из его шрифтов провернуть следующее:</p>\n<p> <strong>Лезем в css проекта</strong>.</p>\n<ol>\n<li>Если нет .css файлов — создаём и объявляем его в manifest.json.\nПуть объявления в манифесте:\n<div class=\"remark-highlight\"><pre class=\"language-JavaScript\"><code class=\"language-JavaScript\">{\n  &#x26;quot;sap.ui5&#x26;quot;: {\n    &#x26;quot;resources&#x26;quot;: {\n      &#x26;quot;css&#x26;quot;: [\n        {\n          &#x26;quot;uri&#x26;quot;: &#x26;quot;css/yourfilename.css&#x26;quot;\n        }\n      ]\n    }\n  }\n}</code></pre></div>\n</li>\n<li><strong>Смотрим в файл</strong> fontawesome/%fontname%.css</li>\n<li><strong>Копируем блок</strong> <strong>@font-face</strong>, в <em>css</em> проекта. Который будет примерно следующим:\n<div class=\"remark-highlight\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token atrule\"><span class=\"token rule\">@font-face</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Font Awesome 5 Free'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">font-style</span><span class=\"token punctuation\">:</span> normal<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">font-weight</span><span class=\"token punctuation\">:</span> <span class=\"token number\">900</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">font-display</span><span class=\"token punctuation\">:</span> block<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">src</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">\"../webfonts/fa-solid-900.eot\"</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">src</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">\"../webfonts/fa-solid-900.eot?#iefix\"</span><span class=\"token punctuation\">)</span></span> <span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"embedded-opentype\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">\"../webfonts/fa-solid-900.woff2\"</span><span class=\"token punctuation\">)</span></span> <span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"woff2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">\"../webfonts/fa-solid-900.woff\"</span><span class=\"token punctuation\">)</span></span> <span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"woff\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">\"../webfonts/fa-solid-900.ttf\"</span><span class=\"token punctuation\">)</span></span> <span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"truetype\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">\"../webfonts/fa-solid-900.svg#fontawesome\"</span><span class=\"token punctuation\">)</span></span> <span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"svg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n</code></pre></div>\n</li>\n<li>Где-нибудь в коде (например, при инициализации Component.js, и <em>желательно</em> в отдельном файле) добавляем нужные нам иконки в пул:\n<div class=\"remark-highlight\"><pre class=\"language-JavaScript\"><code class=\"language-JavaScript\">sap.ui.core.IconPool.addIcon(&#x26;quot;angry&#x26;quot;, &#x26;quot;fa&#x26;quot;, &#x26;quot;Font Awesome 5 Free&#x26;quot;, &#x26;quot;f556&#x26;quot;);\nsap.ui.core.IconPool.addIcon(&#x26;quot;gem&#x26;quot;, &#x26;quot;fa&#x26;quot;, &#x26;quot;Font Awesome 5 Free&#x26;quot;, &#x26;quot;f3a5&#x26;quot;);\n//...</code></pre></div>\n(Названия иконок и их символьные коды можно <a href=\"https://fontawesome.com/icons/gem?style=regular\">подсмотреть на сайте</a>.)\n</li>\n<li>Используем иконки при декларации каких-нибудь элементов экрана:\n<div class=\"remark-highlight\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>Button</span> <span class=\"token attr-name\">text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Очень красивая кнопка<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">icon</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sap-icon://fa/gem<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n</code></pre></div>\n</li>\n</ol>\n<p><img src=\"../assets/blog/sapui5-connect-icons-font/beautiful_button.jpg\" alt=\"Очень красивая кнопка\"></p>\n<p>Кстати, названия всех иконок и их кодов удобно лежат в файле <strong>/scss/_variables.scss</strong>. И они вполне пригодны для автоматической обработки. Ну а шо, а вдруг.</p>\n<iframe width=\"100%\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/TeXk3RFy1rc\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n<div class=\"remark-highlight\"><pre class=\"language-scss\"><code class=\"language-scss\"><span class=\"token comment\">// помимо других переменных, там содержатся $fa-var.* : code</span>\n<span class=\"token property\"><span class=\"token variable\">$fa-var-angry</span></span><span class=\"token punctuation\">:</span> <span title=\"\\f556\" class=\"token entity\">\\f556</span><span class=\"token punctuation\">;</span>\n<span class=\"token property\"><span class=\"token variable\">$fa-var-angrycreative</span></span><span class=\"token punctuation\">:</span> <span title=\"\\f36e\" class=\"token entity\">\\f36e</span><span class=\"token punctuation\">;</span>\n<span class=\"token property\"><span class=\"token variable\">$fa-var-angular</span></span><span class=\"token punctuation\">:</span> <span title=\"\\f420\" class=\"token entity\">\\f420</span><span class=\"token punctuation\">;</span>\n<span class=\"token property\"><span class=\"token variable\">$fa-var-ankh</span></span><span class=\"token punctuation\">:</span> <span title=\"\\f644\" class=\"token entity\">\\f644</span><span class=\"token punctuation\">;</span>\n<span class=\"token property\"><span class=\"token variable\">$fa-var-app-store</span></span><span class=\"token punctuation\">:</span> <span title=\"\\f36f\" class=\"token entity\">\\f36f</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//.......</span>\n</code></pre></div>\n<p>Например, можно автоматически собрать все команды добавления в пул. (Не пытайтесь засунуть всю портянку в проект, это просто пример.)</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">grep</span> -o fa-var.* ./_variables.scss <span class=\"token punctuation\">\\</span>\n <span class=\"token operator\">|</span> <span class=\"token function\">tr</span> --delete <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">\\</span><span class=\"token punctuation\">\\</span> <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> -F<span class=\"token string\">': '</span> <span class=\"token punctuation\">\\</span>\n <span class=\"token string\">'{print \"sap.ui.core.IconPool.addIcon(<span title=\"\\&#x22;\" class=\"token entity\">\\\"</span>\"<span class=\"token variable\">$1</span>\"<span title=\"\\&#x22;\" class=\"token entity\">\\\"</span>,<span title=\"\\&#x22;\" class=\"token entity\">\\\"</span>fa<span title=\"\\&#x22;\" class=\"token entity\">\\\"</span>,<span title=\"\\&#x22;\" class=\"token entity\">\\\"</span>Font Awesome 5 Free<span title=\"\\&#x22;\" class=\"token entity\">\\\"</span>, <span title=\"\\&#x22;\" class=\"token entity\">\\\"</span>\"<span class=\"token variable\">$2</span>\"<span title=\"\\&#x22;\" class=\"token entity\">\\\"</span>);\"}'</span> <span class=\"token punctuation\">\\</span>\n <span class=\"token operator\">></span> iconDefinition.js\n</code></pre></div>\n<p>Получим на выходе вот это:</p>\n<div class=\"remark-highlight\"><pre class=\"language-JavaScript\"><code class=\"language-JavaScript\">sap.ui.core.IconPool.addIcon(&#x26;quot;fa-var-address-card&#x26;quot;,&#x26;quot;fa&#x26;quot;,&#x26;quot;Font Awesome 5 Free&#x26;quot;, &#x26;quot;f2bb&#x26;quot;);\nsap.ui.core.IconPool.addIcon(&#x26;quot;fa-var-adjust&#x26;quot;,&#x26;quot;fa&#x26;quot;,&#x26;quot;Font Awesome 5 Free&#x26;quot;, &#x26;quot;f042&#x26;quot;);\nsap.ui.core.IconPool.addIcon(&#x26;quot;fa-var-adn&#x26;quot;,&#x26;quot;fa&#x26;quot;,&#x26;quot;Font Awesome 5 Free&#x26;quot;, &#x26;quot;f170&#x26;quot;);\nsap.ui.core.IconPool.addIcon(&#x26;quot;fa-var-adobe&#x26;quot;,&#x26;quot;fa&#x26;quot;,&#x26;quot;Font Awesome 5 Free&#x26;quot;, &#x26;quot;f778&#x26;quot;);\n//...</code></pre></div>\n<p>Целый лонгрид о подключении шрифта... Ух.</p>\n<p><img src=\"../assets/blog/sapui5-connect-icons-font/%D0%B4%D0%B5%D0%B3%D1%80%D0%B0%D0%B4%D0%B0%D1%86%D0%B8%D1%8F.jpg\" alt=\"Деградация\"></p>\n<p>На этом всё. Работает. </p>\n<p>P.S. При тестировании внутри <strong>SAP WEB IDE</strong> на <strong>Internet Explorer</strong> могут наблюдаться фантомные проблемы с отображением иконок. Но после деплоя — всё работает.</p>\n<p><a href=\"/tags/javascript\">#javascript</a> <a href=\"/tags/sapui5\">#sapui5</a> </p>\n","ogImage":{"url":"/assets/blog/sapui5-connect-icons-font/background.jpg"},"coverImage":"/assets/blog/sapui5-connect-icons-font/background.jpg","issueId":"17"}},"__N_SSG":true}