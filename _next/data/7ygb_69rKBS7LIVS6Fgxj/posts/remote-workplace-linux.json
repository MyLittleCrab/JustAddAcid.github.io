{"pageProps":{"post":{"title":"Организуем удалённое рабочее место на машине с linux","date":"2020-06-07T14:15:07.322Z","slug":"remote-workplace-linux","author":{"name":"Roman A. Nosov","picture":"https://avatars3.githubusercontent.com/u/21103635?s=120&v=4","url":"https://github.com/JustAddAcid"},"content":"<p>На фоне эпидемии появилась необходимость в организации удобной удалённой работы на домашнем компьютере с ос <em>linux</em> на борту: настроить <em>rdp</em> клиент + <em>skype for business</em> (<em>lync</em>).</p>\n<h3>Зачем?</h3>\n<p>Не все работодатели готовы предоставлять работникам именно <em>VPN</em> для доступа к корпоративным сервисам. Лишь открывают RDP-терминал. Видимо, так им кажется безопаснее ¯\\<em>(ツ)</em>/¯. А также, некоторые вещи физически невозможно развернуть на локальных машинах, так что в некоторых ситуациях протокол удалённых рабочих столов просто необходим.</p>\n<h3>Как должно работать в идеале:</h3>\n<ol>\n<li>Нужен настроенный <em>RDP</em> клиент с поддержкой <em>gateways</em> на linux, который по одному клику открывает рабочий стол удалённой машины.</li>\n<li>Нужна возможность созваниваться по skype for business с коллегами без огромных задержек от RDP. В идеале — запуск клиента на локальной машине.</li>\n</ol>\n<h2>Добываем себе возможность работать в трусах</h2>\n<p><img src=\"../assets/blog/remote-workplace-linux/meme.jpg\" alt=\"Удалёнка\"></p>\n<h3>RDP</h3>\n<p>В качестве rdp клиента будем использовать <em>freerdp</em> — это один из немногих linux rdp клиентов, который поддерживает шлюзы (gateways). Устанавливаем:</p>\n<pre><code class=\"language-bash\">sudo apt instal freerdp\n</code></pre>\n<p>Теперь запускать удалённые rdp-сеансы мы можем с помощью консольной команды <strong>xfreerdp</strong>. С определенными параметрами:</p>\n<p>Со всеми доступными параметрами можно <a href=\"https://github.com/FreeRDP/FreeRDP/wiki/CommandLineInterface\" title=\"CommandLineInterface\">познакомиться (здесь)</a>. Но нас интересуют вполне конкретные:</p>\n<ol>\n<li><strong>/f</strong> — fullscreen mode</li>\n<li><strong>/multimon</strong> — поддержка нескольких мониторов</li>\n<li><strong>/rfx</strong> — \"расширенный\" протокол поверх RDP. </li>\n<li>(опционально) <strong>/sound:sys:alsa</strong> — включение стриминга звука на локальную машину</li>\n<li><strong>+clipboard</strong> — расшаривание буфера обмена между удалённым рабочим столом и клиентской машиной</li>\n<li><strong>+fonts</strong> — включить сглаживание шрифтов. </li>\n<li><strong>/v</strong> — хост url</li>\n<li><strong>/d</strong> — домен пользователя,</li>\n<li><strong>/u</strong> — пользователь</li>\n<li><strong>/p</strong> — пароль пользователя</li>\n<li><strong>/g</strong> — шлюз url</li>\n<li><strong>/gd</strong> — домен для авторизации на шлюзе</li>\n<li><strong>/gu</strong> — пользователь для авторизации на шлюзе</li>\n<li><strong>/gp</strong> — пароль для авторизации на шлюзе</li>\n</ol>\n<p>Итоговый скрипт запуска у нас будет следующим:</p>\n<pre><code class=\"language-bash\">#! /bin/bash\n\nxfreerdp /v:targetUrl /d:domain /u:username /p:password /g:gateway /gd:domain /gu:username /gp:password /f /multimon /rfx /sound:sys:alsa +clipboard +fonts\n</code></pre>\n<p>Всё это можно сохранить в текстовом файле, сделать его исполняемым и положить для удобства на рабочий стол.</p>\n<pre><code class=\"language-bash\">sudo chmod +x filename # Сделать исполняемым\n</code></pre>\n<h3>Skype for business (lync)</h3>\n<p>Несмотря на то, что порт обычной (не бизнесовой) версии скайпа  на линукс официально поставляется разработчиками — бизнесовой версии под linux <strong>нет</strong>. Браузерная версия Skype (<em>Skype web app</em>) тоже не заведется, т.к. для его функционирования нужно нативное windows-расширение для браузера. Как быть?</p>\n<p>В этом нам поможет прекрасный плагин для мессенджеров — <a href=\"https://sipe.sourceforge.io/\" title=\"A third-party Pidgin plugin for Microsoft LCS/OCS\">SIPE</a>. Он позиционирует себя как open-source имплементация протокола OCS, по которому общаются клиенты <em>Skype for business</em>.</p>\n<p>Установим pidgin + sipe</p>\n<pre><code class=\"language-bash\">sudo apt install pidgin pidgin-sipe\n</code></pre>\n<p>При создании учетных записей выбираем протокол \"Office Communicator\"\n<img src=\"../assets/blog/remote-workplace-linux/pidgin-protocols.png\" alt=\"Pidgin protocols list\"></p>\n<p>Вводим active directory login/e-mail/пароль. И вуаля! Подключается и работает.</p>\n<p>Поскольку, это не официальный клиент, многие (не основные) функции могут отсутствовать. Но базовых более чем хватает:</p>\n<ol>\n<li>Чат</li>\n<li>Звонки, как приватные, так и конференции. </li>\n<li>Демонстрация рабочего стола</li>\n<li>Совместное использование рабочего стола</li>\n</ol>\n<p><a href=\"/tags/linux\">#linux</a> <a href=\"/tags/%D1%82%D0%B0%D0%BD%D1%86%D1%8B_%D1%81_%D0%B1%D1%83%D0%B1%D0%BD%D0%BE%D0%BC\">#танцы<em>с</em>бубном</a> <a href=\"/tags/%D0%BE%D1%84%D0%B8%D1%81%D0%BD%D0%B0%D1%8F_%D0%B1%D0%BE%D0%BB%D1%8C\">#офисная_боль</a> </p>\n","ogImage":{"url":"/assets/blog/remote-workplace-linux/logo.jpg"},"coverImage":"/assets/blog/remote-workplace-linux/logo.jpg","issueId":"9"}},"__N_SSG":true}